(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3128],{14636:(e,t,s)=>{"use strict";s.d(t,{AM:()=>i,Wv:()=>d,hl:()=>o});var a=s(95155),r=s(12115),n=s(20547),l=s(59434);let i=n.bL,d=n.l9,o=r.forwardRef((e,t)=>{let{className:s,align:r="center",sideOffset:i=4,...d}=e;return(0,a.jsx)(n.ZL,{children:(0,a.jsx)(n.UC,{ref:t,align:r,sideOffset:i,className:(0,l.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...d})})});o.displayName=n.UC.displayName},17759:(e,t,s)=>{"use strict";s.d(t,{C5:()=>j,MJ:()=>f,Rr:()=>g,eI:()=>h,lR:()=>x,lV:()=>o,zB:()=>u});var a=s(95155),r=s(12115),n=s(99708),l=s(62177),i=s(59434),d=s(85057);let o=l.Op,c=r.createContext({}),u=e=>{let{...t}=e;return(0,a.jsx)(c.Provider,{value:{name:t.name},children:(0,a.jsx)(l.xI,{...t})})},m=()=>{let e=r.useContext(c),t=r.useContext(p),{getFieldState:s,formState:a}=(0,l.xW)(),n=s(e.name,a);if(!e)throw Error("useFormField should be used within <FormField>");let{id:i}=t;return{id:i,name:e.name,formItemId:"".concat(i,"-form-item"),formDescriptionId:"".concat(i,"-form-item-description"),formMessageId:"".concat(i,"-form-item-message"),...n}},p=r.createContext({}),h=r.forwardRef((e,t)=>{let{className:s,...n}=e,l=r.useId();return(0,a.jsx)(p.Provider,{value:{id:l},children:(0,a.jsx)("div",{ref:t,className:(0,i.cn)("space-y-2",s),...n})})});h.displayName="FormItem";let x=r.forwardRef((e,t)=>{let{className:s,...r}=e,{error:n,formItemId:l}=m();return(0,a.jsx)(d.J,{ref:t,className:(0,i.cn)(n&&"text-destructive",s),htmlFor:l,...r})});x.displayName="FormLabel";let f=r.forwardRef((e,t)=>{let{...s}=e,{error:r,formItemId:l,formDescriptionId:i,formMessageId:d}=m();return(0,a.jsx)(n.DX,{ref:t,id:l,"aria-describedby":r?"".concat(i," ").concat(d):"".concat(i),"aria-invalid":!!r,...s})});f.displayName="FormControl";let g=r.forwardRef((e,t)=>{let{className:s,...r}=e,{formDescriptionId:n}=m();return(0,a.jsx)("p",{ref:t,id:n,className:(0,i.cn)("text-sm text-muted-foreground",s),...r})});g.displayName="FormDescription";let j=r.forwardRef((e,t)=>{var s;let{className:r,children:n,...l}=e,{error:d,formMessageId:o}=m(),c=d?String(null!=(s=null==d?void 0:d.message)?s:""):n;return c?(0,a.jsx)("p",{ref:t,id:o,className:(0,i.cn)("text-sm font-medium text-destructive",r),...l,children:c}):null});j.displayName="FormMessage"},17763:(e,t,s)=>{Promise.resolve().then(s.bind(s,86841))},55365:(e,t,s)=>{"use strict";s.d(t,{Fc:()=>d,TN:()=>c,XL:()=>o});var a=s(95155),r=s(12115),n=s(74466),l=s(59434);let i=(0,n.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),d=r.forwardRef((e,t)=>{let{className:s,variant:r,...n}=e;return(0,a.jsx)("div",{ref:t,role:"alert",className:(0,l.cn)(i({variant:r}),s),...n})});d.displayName="Alert";let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("h5",{ref:t,className:(0,l.cn)("mb-1 font-medium leading-none tracking-tight",s),...r})});o.displayName="AlertTitle";let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("text-sm [&_p]:leading-relaxed",s),...r})});c.displayName="AlertDescription"},59409:(e,t,s)=>{"use strict";s.d(t,{bq:()=>m,eb:()=>f,gC:()=>x,l6:()=>c,yv:()=>u});var a=s(95155),r=s(12115),n=s(8194),l=s(79556),i=s(77381),d=s(10518),o=s(59434);let c=n.bL;n.YJ;let u=n.WT,m=r.forwardRef((e,t)=>{let{className:s,children:r,...i}=e;return(0,a.jsxs)(n.l9,{ref:t,className:(0,o.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...i,children:[r,(0,a.jsx)(n.In,{asChild:!0,children:(0,a.jsx)(l.A,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=n.l9.displayName;let p=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.PP,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",s),...r,children:(0,a.jsx)(i.A,{className:"h-4 w-4"})})});p.displayName=n.PP.displayName;let h=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.wn,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",s),...r,children:(0,a.jsx)(l.A,{className:"h-4 w-4"})})});h.displayName=n.wn.displayName;let x=r.forwardRef((e,t)=>{let{className:s,children:r,position:l="popper",...i}=e;return(0,a.jsx)(n.ZL,{children:(0,a.jsxs)(n.UC,{ref:t,className:(0,o.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:l,...i,children:[(0,a.jsx)(p,{}),(0,a.jsx)(n.LM,{className:(0,o.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,a.jsx)(h,{})]})})});x.displayName=n.UC.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.JU,{ref:t,className:(0,o.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...r})}).displayName=n.JU.displayName;let f=r.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsxs)(n.q7,{ref:t,className:(0,o.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...l,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(n.VF,{children:(0,a.jsx)(d.A,{className:"h-4 w-4"})})}),(0,a.jsx)(n.p4,{children:r})]})});f.displayName=n.q7.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.wv,{ref:t,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",s),...r})}).displayName=n.wv.displayName},62523:(e,t,s)=>{"use strict";s.d(t,{p:()=>l});var a=s(95155),r=s(12115),n=s(59434);let l=r.forwardRef((e,t)=>{let{className:s,type:r,...l}=e;return(0,a.jsx)("input",{type:r,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...l})});l.displayName="Input"},85057:(e,t,s)=>{"use strict";s.d(t,{J:()=>o});var a=s(95155),r=s(12115),n=s(40968),l=s(74466),i=s(59434);let d=(0,l.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.b,{ref:t,className:(0,i.cn)(d(),s),...r})});o.displayName=n.b.displayName},85127:(e,t,s)=>{"use strict";s.d(t,{A0:()=>i,BF:()=>d,Hj:()=>o,XI:()=>l,nA:()=>u,nd:()=>c});var a=s(95155),r=s(12115),n=s(59434);let l=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:t,className:(0,n.cn)("w-full caption-bottom text-sm",s),...r})})});l.displayName="Table";let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("thead",{ref:t,className:(0,n.cn)("[&_tr]:border-b",s),...r})});i.displayName="TableHeader";let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("tbody",{ref:t,className:(0,n.cn)("[&_tr:last-child]:border-0",s),...r})});d.displayName="TableBody",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("tfoot",{ref:t,className:(0,n.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...r})}).displayName="TableFooter";let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("tr",{ref:t,className:(0,n.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...r})});o.displayName="TableRow";let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("th",{ref:t,className:(0,n.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...r})});c.displayName="TableHead";let u=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("td",{ref:t,className:(0,n.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...r})});u.displayName="TableCell",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("caption",{ref:t,className:(0,n.cn)("mt-4 text-sm text-muted-foreground",s),...r})}).displayName="TableCaption"},85511:(e,t,s)=>{"use strict";s.d(t,{V:()=>o});var a=s(95155);s(12115);var r=s(965),n=s(73158),l=s(77020),i=s(59434),d=s(30285);function o(e){let{className:t,classNames:s,showOutsideDays:o=!0,...c}=e;return(0,a.jsx)(l.hv,{showOutsideDays:o,className:(0,i.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,i.cn)((0,d.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,i.cn)((0,d.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...s},components:{IconLeft:e=>{let{className:t,...s}=e;return(0,a.jsx)(r.A,{className:(0,i.cn)("h-4 w-4",t),...s})},IconRight:e=>{let{className:t,...s}=e;return(0,a.jsx)(n.A,{className:(0,i.cn)("h-4 w-4",t),...s})}},...c})}o.displayName="Calendar"},86841:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>el});var a=s(95155),r=s(12115),n=s(90221),l=s(62177),i=s(55594),d=s(30285),o=s(17759),c=s(62523),u=s(88539),m=s(85127),p=s(66695),h=s(59409),x=s(85511),f=s(14636),g=s(55365),j=s(87481),v=s(59434),b=s(94618),y=s(44861),N=s(80644),w=s(53941),A=s(83343),C=s(85388),I=s(50172),R=s(15300),T=s(34301),k=s(23027),D=s(9572),E=s(51920),F=s(25318),P=s(67933),S=s(74601),M=s(88390),U=s(15222),_=s(77223),L=s(50594),O=s(68718),B=s(66766),V=s(34477);let q=(0,V.createServerReference)("40dc12ff6aade17c2b480cff9632b0364b2480bd8f",V.callServer,void 0,V.findSourceMapURL,"receiptParserFlow"),z=(0,V.createServerReference)("40927f8807ec76451e0441317d257c24c9ce49bc73",V.callServer,void 0,V.findSourceMapURL,"getTaxAdvice");var $=s(59576),G=s(56104),J=s(35317),W=s(90858),Y=s(55028);let Z=(0,Y.default)(()=>s.e(8927).then(s.bind(s,54165)).then(e=>e.Dialog),{loadableGenerated:{webpack:()=>[54165]},ssr:!1,loading:()=>(0,a.jsxs)("div",{className:"p-4 text-center",children:[(0,a.jsx)(I.A,{className:"h-6 w-6 animate-spin inline-block"})," Loading Dialog..."]})}),H=(0,Y.default)(()=>s.e(8927).then(s.bind(s,54165)).then(e=>e.DialogContent),{loadableGenerated:{webpack:()=>[54165]},ssr:!1}),X=(0,Y.default)(()=>s.e(8927).then(s.bind(s,54165)).then(e=>e.DialogHeader),{loadableGenerated:{webpack:()=>[54165]},ssr:!1}),K=(0,Y.default)(()=>s.e(8927).then(s.bind(s,54165)).then(e=>e.DialogTitle),{loadableGenerated:{webpack:()=>[54165]},ssr:!1}),Q=(0,Y.default)(()=>s.e(8927).then(s.bind(s,54165)).then(e=>e.DialogFooter),{loadableGenerated:{webpack:()=>[54165]},ssr:!1}),ee=(0,Y.default)(()=>s.e(8927).then(s.bind(s,54165)).then(e=>e.DialogClose),{loadableGenerated:{webpack:()=>[54165]},ssr:!1}),et=(0,Y.default)(()=>s.e(8927).then(s.bind(s,54165)).then(e=>e.DialogDescription),{loadableGenerated:{webpack:()=>[54165]},ssr:!1}),es=(0,Y.default)(()=>s.e(8927).then(s.bind(s,54165)).then(e=>e.Dialog),{loadableGenerated:{webpack:()=>[54165]},ssr:!1,loading:()=>(0,a.jsxs)("div",{className:"p-4 text-center",children:[(0,a.jsx)(I.A,{className:"h-6 w-6 animate-spin inline-block"})," Loading Camera..."]})}),ea=["Ingredient","Equipment","Tax","BAS","Travel","Other"],er=i.Ik({vendor:i.Yj().min(1,{message:"Vendor name is required."}),date:i.p6({required_error:"Receipt date is required."}),totalAmount:i.au.number().min(.01,{message:"Total amount must be greater than 0."}),assignedToEventId:i.Yj().optional(),assignedToMenuId:i.Yj().optional(),costType:i.k5(["Ingredient","Equipment","Tax","BAS","Travel","Other"],{required_error:"Cost type is required."}),notes:i.Yj().optional()}),en=i.Ik({region:i.Yj().min(2,{message:"Region is required (e.g., Australia, California)."}),query:i.Yj().min(10,{message:"Please enter a specific tax question (min 10 characters)."})});function el(){let{user:e}=(0,$.A)(),[t,s]=(0,r.useState)([]),[i,V]=(0,r.useState)(!0),[Y,el]=(0,r.useState)(!1),[ei,ed]=(0,r.useState)(!1),[eo,ec]=(0,r.useState)(null),[eu,em]=(0,r.useState)(!1),[ep,eh]=(0,r.useState)(null),[ex,ef]=(0,r.useState)(null),[eg,ej]=(0,r.useState)(null),[ev,eb]=(0,r.useState)(!1),[ey,eN]=(0,r.useState)(!1),[ew,eA]=(0,r.useState)(!1),[eC,eI]=(0,r.useState)(null),[eR,eT]=(0,r.useState)(!1),ek=(0,r.useRef)(null),eD=(0,r.useRef)(null),eE=(0,r.useRef)(null),[eF,eP]=(0,r.useState)("all"),[eS,eM]=(0,r.useState)(void 0),[eU,e_]=(0,r.useState)(void 0),{toast:eL}=(0,j.dj)(),eO=(0,l.mN)({resolver:(0,n.u)(er),defaultValues:{vendor:"",date:new Date,totalAmount:0,assignedToEventId:"",assignedToMenuId:"",costType:void 0,notes:""}}),eB=(0,l.mN)({resolver:(0,n.u)(en),defaultValues:{region:"",query:""}});(0,r.useEffect)(()=>{let t;if(e){V(!0);let a=(0,J.rJ)(G.db,"users",e.uid,"receipts"),r=(0,J.P)(a,(0,J.My)("date","desc"));try{t=(0,J.aQ)(r,e=>{let t=e.docs.map(e=>{let t=e.data();return{id:e.id,...t,vendor:t.vendor,totalAmount:"number"==typeof t.totalAmount?t.totalAmount:parseFloat(t.totalAmount||"0"),costType:t.costType,assignedToEventId:t.assignedToEventId,assignedToMenuId:t.assignedToMenuId,notes:t.notes,imageUrl:t.imageUrl,fileName:t.fileName,date:t.date instanceof J.Dc?t.date.toDate():t.date?(0,b.S)(t.date.seconds):new Date,createdAt:t.createdAt instanceof J.Dc?t.createdAt.toDate():t.createdAt?(0,b.S)(t.createdAt.seconds):void 0,updatedAt:t.updatedAt instanceof J.Dc?t.updatedAt.toDate():t.updatedAt?(0,b.S)(t.updatedAt.seconds):void 0}});s(t),V(!1)},e=>{console.error("Error fetching receipts:",e),eL({title:"Error",description:"Could not fetch your receipts.",variant:"destructive"}),V(!1)})}catch(e){console.error("Error setting up receipts listener:",e),eL({title:"Setup Error",description:"Failed to initialize receipt tracking.",variant:"destructive"}),V(!1)}}else V(!1),s([]);return()=>{t&&t()}},[e,eL]),(0,r.useEffect)(()=>{let e=null,t=async()=>{if(eu&&ek.current&&null===ep&&!ev)try{e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}),eh(!0),ek.current&&(ek.current.srcObject=e)}catch(e){console.error("Error accessing camera:",e),eh(!1),eL({variant:"destructive",title:"Camera Access Denied",description:"Please enable camera permissions in your browser settings."})}};return eu&&!ev&&t(),()=>{e&&e.getTracks().forEach(e=>e.stop()),ek.current&&(ek.current.srcObject=null)}},[eu,ep,eL,ev]);let eV=(0,r.useMemo)(()=>t.filter(e=>{let t="all"===eF||e.costType===eF,s=e.date;if(s instanceof Date||!s||(s=new Date(s)),!(0,y.f)(s))return!1;let a=(0,N.o)(s),r=!eS||a>=(0,N.o)(eS),n=!eU||a<=(0,w.D)(eU);return t&&r&&n}),[t,eF,eS,eU]),eq=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(ec(e),ef((null==e?void 0:e.imageUrl)||null),ej((null==e?void 0:e.fileName)||null),eb(!1),eE.current&&(eE.current.value=""),e){let t=new Date;e.date&&(e.date instanceof J.Dc?t=e.date.toDate():e.date instanceof Date&&(0,y.f)(receiptToSet)&&(t=e.date)),eO.reset({vendor:e.vendor,date:t,totalAmount:e.totalAmount,assignedToEventId:e.assignedToEventId||"",assignedToMenuId:e.assignedToMenuId||"",costType:e.costType,notes:e.notes||""})}else eO.reset({vendor:"",date:new Date,totalAmount:0,assignedToEventId:"",assignedToMenuId:"",costType:void 0,notes:""});ed(!0)},ez=async()=>{if(!ex)return void eL({title:"No Image",description:"Please capture or upload an image first.",variant:"destructive"});eN(!0),eL({title:"AI Processing",description:"Analyzing receipt image..."});try{let e=await q({receiptImageUri:ex});if(e){if(e.vendor&&eO.setValue("vendor",e.vendor),e.date)try{let t=(0,A.H)(e.date);(0,y.f)(t)||(t=new Date(e.date.replace(/-/g,"/"))),(0,y.f)(t)?eO.setValue("date",t):(console.warn("AI returned unparsable date format for receipt:",e.date),eL({title:"AI Autofill",description:"Could not parse date from AI. Please set manually.",variant:"default"}))}catch(t){console.warn("Error processing date from AI for receipt:",e.date,t),eL({title:"AI Autofill",description:"Error processing date from AI. Please set manually.",variant:"default"})}void 0!==e.totalAmount&&null!==e.totalAmount&&eO.setValue("totalAmount",e.totalAmount),e.suggestedCostType&&eO.setValue("costType",e.suggestedCostType),eL({title:"AI Autofill Complete",description:"Fields populated. Please review."})}else eL({title:"AI Autofill",description:"Could not extract all information. Please fill manually.",variant:"default"})}catch(t){console.error("Error parsing receipt with AI:",t);let e="Failed to process receipt with AI. ".concat(t.message);t.message&&t.message.toLowerCase().includes("api key not valid")&&(e="AI Service Error: Invalid API Key for receipt parsing."),eL({title:"AI Error",description:e,variant:"destructive"})}finally{eN(!1)}},e$=e=>{try{let t=atob(e.split(",")[1]),s=e.split(",")[0].split(":")[1].split(";")[0],a=new ArrayBuffer(t.length),r=new Uint8Array(a);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return new Blob([a],{type:s})}catch(e){return console.error("Error converting data URI to Blob:",e),eL({title:"Image Error",description:"Could not process captured image.",variant:"destructive"}),null}},eG=async t=>{if(!e)return void eL({title:"Error",description:"You must be logged in.",variant:"destructive"});if(!ex&&!(null==eo?void 0:eo.imageUrl))return void eL({title:"Image Required",description:"Please capture or upload a receipt image.",variant:"destructive"});el(!0);let s=(null==eo?void 0:eo.imageUrl)||"",a=eg||(null==eo?void 0:eo.fileName)||"receipt_".concat(Date.now(),".jpg");try{let r=(null==eo?void 0:eo.id)||(0,J.H9)((0,J.rJ)(G.db,"users/".concat(e.uid,"/receipts"))).id,n=(0,J.H9)(G.db,"users",e.uid,"receipts",r);if(ex&&(!eo||ex!==eo.imageUrl)){if((null==eo?void 0:eo.imageUrl)&&eo.imageUrl.startsWith("https://firebasestorage.googleapis.com"))try{let e=(0,W.KR)(G.IG,eo.imageUrl);await (0,W.XR)(e)}catch(e){"storage/object-not-found"!==e.code&&console.warn("ReceiptsPage: Could not delete old receipt image during update:",e.message)}let t=e$(ex);if(!t)throw Error("Failed to convert image data for upload.");let n="users/".concat(e.uid,"/receipts/").concat(r,"/").concat(a.replace(/[^a-zA-Z0-9_.-]/g,"_")),l=(0,W.KR)(G.IG,n),i=(0,W.bp)(l,t);await new Promise((e,t)=>{i.on("state_changed",e=>{},e=>{console.error("Receipt image upload error:",e),t(e)},async()=>{try{s=await (0,W.qk)(i.snapshot.ref),e()}catch(e){console.error("Error getting download URL for receipt image:",e),t(e)}})})}let l={...t,chefId:e.uid,date:J.Dc.fromDate(t.date),imageUrl:s,fileName:a,updatedAt:(0,J.O5)()};eo?(await (0,J.mZ)(n,l),eL({title:"Receipt Updated",description:'Receipt from "'.concat(t.vendor,'" has been updated.')})):(await (0,J.BN)(n,{...l,id:n.id,createdAt:(0,J.O5)()}),eL({title:"Receipt Added",description:'Receipt from "'.concat(t.vendor,'" has been added.')})),eO.reset(),ec(null),ed(!1),ef(null),ej(null),eE.current&&(eE.current.value="")}catch(e){console.error("Error saving receipt:",e),eL({title:"Save Failed",description:"Could not save receipt. ".concat(e.message),variant:"destructive"})}finally{el(!1)}},eJ=async s=>{if(!e)return void eL({title:"Authentication Error",description:"You must be logged in.",variant:"destructive"});let a=t.find(e=>e.id===s);if(!a)return void eL({title:"Error",description:"Receipt not found.",variant:"destructive"});if(window.confirm('Are you sure you want to delete the receipt from "'.concat(null==a?void 0:a.vendor,'"?'))){el(!0);try{if(a.imageUrl&&a.imageUrl.startsWith("https://firebasestorage.googleapis.com"))try{let e=(0,W.KR)(G.IG,a.imageUrl);await (0,W.XR)(e)}catch(e){"storage/object-not-found"!==e.code&&console.warn("ReceiptsPage: Could not delete receipt image from storage during receipt deletion:",e.message)}await (0,J.kd)((0,J.H9)(G.db,"users",e.uid,"receipts",s)),eL({title:"Receipt Deleted",description:'Receipt from "'.concat(null==a?void 0:a.vendor,'" removed.'),variant:"destructive"})}catch(e){console.error("Error deleting receipt:",e),eL({title:"Delete Error",description:"Could not delete receipt. ".concat(e.message),variant:"destructive"})}finally{el(!1)}}},eW=(0,r.useMemo)(()=>eV.reduce((e,t)=>e+t.totalAmount,0),[eV]),eY=(0,r.useMemo)(()=>{let e={};return ea.forEach(t=>e[t]=0),eV.forEach(t=>{ea.includes(t.costType)&&(e[t.costType]=(e[t.costType]||0)+t.totalAmount)}),e},[eV]),eZ=async e=>{eT(!0),eI(null),eL({title:"Getting Tax Advice",description:"Please wait..."});try{let t=await z(e);eI(t)}catch(t){console.error("Error getting tax advice:",t);let e="Failed to get tax advice. ".concat(t.message);t.message&&t.message.toLowerCase().includes("api key not valid")&&(e="AI Service Error: Invalid API Key for tax advice."),eL({title:"AI Error",description:e,variant:"destructive"}),eI({advice:"Could not retrieve advice at this time.",disclaimer:"Please try again later."})}finally{eT(!1)}};return i&&(!e||0===t.length)?(0,a.jsxs)("div",{className:"flex justify-center items-center h-64",children:[(0,a.jsx)(I.A,{className:"h-8 w-8 animate-spin text-primary","data-ai-hint":"loading spinner"}),(0,a.jsx)("p",{className:"ml-2",children:"Loading receipts data..."})]}):(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold flex items-center",children:[(0,a.jsx)(R.A,{className:"mr-3 h-8 w-8 text-primary","data-ai-hint":"document file"})," Receipts & Cost Management"]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)(d.$,{onClick:()=>eq(),disabled:Y||ey,children:[(0,a.jsx)(T.A,{className:"mr-2 h-5 w-5"})," Add New Receipt"]}),Z&&(0,a.jsxs)(d.$,{variant:"outline",onClick:()=>{eB.reset(),eI(null),eA(!0)},children:[(0,a.jsx)(k.A,{className:"mr-2 h-5 w-5"})," Get Tax Advice"]})]})]}),(0,a.jsxs)(p.Zp,{children:[(0,a.jsx)(p.aR,{children:(0,a.jsxs)(p.ZB,{className:"flex items-center",children:[(0,a.jsx)(D.A,{className:"mr-2 h-5 w-5 text-primary","data-ai-hint":"filter icon"})," Filter Receipts"]})}),(0,a.jsxs)(p.Wu,{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end",children:[(0,a.jsxs)(o.eI,{children:[(0,a.jsx)(o.lR,{children:"Cost Type"}),(0,a.jsxs)(h.l6,{value:eF,onValueChange:eP,children:[(0,a.jsx)(h.bq,{children:(0,a.jsx)(h.yv,{placeholder:"All Cost Types"})}),(0,a.jsxs)(h.gC,{children:[(0,a.jsx)(h.eb,{value:"all",children:"All Cost Types"}),ea.map(e=>(0,a.jsx)(h.eb,{value:e,children:e},e))]})]})]}),(0,a.jsxs)(o.eI,{children:[(0,a.jsx)(o.lR,{children:"Start Date"}),(0,a.jsxs)(f.AM,{children:[(0,a.jsx)(f.Wv,{asChild:!0,children:(0,a.jsxs)(d.$,{variant:"outline",className:(0,v.cn)("w-full justify-start text-left font-normal",!eS&&"text-muted-foreground"),children:[(0,a.jsx)(E.A,{className:"mr-2 h-4 w-4"}),eS?(0,C.GP)(eS,"PPP"):(0,a.jsx)("span",{children:"Pick a start date"})]})}),(0,a.jsx)(f.hl,{className:"w-auto p-0",children:(0,a.jsx)(x.V,{mode:"single",selected:eS,onSelect:eM,initialFocus:!0})})]})]}),(0,a.jsxs)(o.eI,{children:[(0,a.jsx)(o.lR,{children:"End Date"}),(0,a.jsxs)(f.AM,{children:[(0,a.jsx)(f.Wv,{asChild:!0,children:(0,a.jsxs)(d.$,{variant:"outline",className:(0,v.cn)("w-full justify-start text-left font-normal",!eU&&"text-muted-foreground"),children:[(0,a.jsx)(E.A,{className:"mr-2 h-4 w-4"}),eU?(0,C.GP)(eU,"PPP"):(0,a.jsx)("span",{children:"Pick an end date"})]})}),(0,a.jsx)(f.hl,{className:"w-auto p-0",children:(0,a.jsx)(x.V,{mode:"single",selected:eU,onSelect:e_,initialFocus:!0,disabled:e=>!!eS&&e<eS})})]})]}),(0,a.jsxs)(d.$,{onClick:()=>{eP("all"),eM(void 0),e_(void 0)},variant:"outline",className:"self-end",children:[(0,a.jsx)(F.A,{className:"mr-2 h-4 w-4"})," Clear Filters"]})]})]}),ei&&Z&&H&&X&&K&&Q&&ee&&(0,a.jsx)(Z,{open:ei,onOpenChange:e=>{(Y||ey)&&e||(ed(e),!e&&(ef(null),ej(null),eb(!1),eE.current&&(eE.current.value="")))},children:(0,a.jsxs)(H,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)(X,{children:[(0,a.jsx)(K,{children:eo?"Edit Receipt":"Add New Receipt"}),et&&(0,a.jsx)(et,{children:"Fill in the details for your expense. Use camera or upload a file."})]}),(0,a.jsx)(o.lV,{...eO,children:(0,a.jsxs)("form",{onSubmit:eO.handleSubmit(eG),className:"space-y-4 p-1",children:[(0,a.jsxs)(o.eI,{children:[(0,a.jsx)(o.lR,{children:"Receipt Image"}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-center gap-2",children:[es&&(0,a.jsxs)(d.$,{type:"button",variant:"outline",onClick:()=>{eh(null),eb(!1),em(!0)},className:"w-full sm:w-auto",children:[(0,a.jsx)(P.A,{className:"mr-2 h-4 w-4"})," Capture with Camera"]}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground hidden sm:block",children:"OR"}),(0,a.jsx)(c.p,{id:"receipt-upload-input",type:"file",accept:"image/png, image/jpeg, image/webp, application/pdf",className:"w-full sm:flex-1",onChange:e=>{var t;let s=null==(t=e.target.files)?void 0:t[0];if(s){ej(s.name);let e=new FileReader;e.onloadend=()=>{ef(e.result)},e.readAsDataURL(s)}else ej(null),ef(null)},ref:eE})]}),ex&&(0,a.jsxs)("div",{className:"mt-2 text-center",children:[(0,a.jsx)(B.default,{src:ex,alt:"Receipt preview",width:150,height:200,className:"rounded-md object-contain mx-auto border","data-ai-hint":"receipt document"}),eg&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Preview of: ",eg]})]}),(0,a.jsx)(o.Rr,{children:"Max 5MB. PDF, JPG, PNG, WEBP."}),(0,a.jsxs)(d.$,{type:"button",onClick:ez,disabled:!ex||ey||Y,variant:"outline",className:"w-full mt-2",children:[ey?(0,a.jsx)(I.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,a.jsx)(S.A,{className:"mr-2 h-4 w-4"}),ey?"Parsing...":"Auto-fill with AI (from image)"]})]}),(0,a.jsx)(o.zB,{control:eO.control,name:"vendor",render:e=>{let{field:t}=e;return(0,a.jsxs)(o.eI,{children:[(0,a.jsx)(o.lR,{children:"Vendor Name"}),(0,a.jsx)(o.MJ,{children:(0,a.jsx)(c.p,{placeholder:"e.g., Fresh Produce Market",...t})}),(0,a.jsx)(o.C5,{})]})}}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)(o.zB,{control:eO.control,name:"date",render:e=>{let{field:t}=e;return(0,a.jsxs)(o.eI,{className:"flex flex-col",children:[(0,a.jsx)(o.lR,{children:"Date of Receipt"}),(0,a.jsxs)(f.AM,{children:[(0,a.jsx)(f.Wv,{asChild:!0,children:(0,a.jsx)(o.MJ,{children:(0,a.jsxs)(d.$,{variant:"outline",className:(0,v.cn)("w-full pl-3 text-left font-normal",!t.value&&"text-muted-foreground"),children:[t.value?(0,C.GP)(t.value,"PPP"):(0,a.jsx)("span",{children:"Pick a date"}),(0,a.jsx)(E.A,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),(0,a.jsx)(f.hl,{className:"w-auto p-0",align:"start",children:(0,a.jsx)(x.V,{mode:"single",selected:t.value,onSelect:t.onChange,initialFocus:!0})})]}),(0,a.jsx)(o.C5,{})]})}}),(0,a.jsx)(o.zB,{control:eO.control,name:"totalAmount",render:e=>{let{field:t}=e;return(0,a.jsxs)(o.eI,{children:[(0,a.jsx)(o.lR,{children:"Total Amount ($)"}),(0,a.jsx)(o.MJ,{children:(0,a.jsx)(c.p,{type:"number",step:"0.01",placeholder:"e.g., 45.99",...t})}),(0,a.jsx)(o.C5,{})]})}})]}),(0,a.jsx)(o.zB,{control:eO.control,name:"costType",render:e=>{let{field:t}=e;return(0,a.jsxs)(o.eI,{children:[(0,a.jsx)(o.lR,{children:"Cost Type"}),(0,a.jsxs)(h.l6,{onValueChange:t.onChange,value:t.value,defaultValue:t.value,children:[(0,a.jsx)(o.MJ,{children:(0,a.jsx)(h.bq,{children:(0,a.jsx)(h.yv,{placeholder:"Select a cost type"})})}),(0,a.jsx)(h.gC,{children:ea.map(e=>(0,a.jsx)(h.eb,{value:e,children:e},e))})]}),(0,a.jsx)(o.C5,{})]})}}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)(o.zB,{control:eO.control,name:"assignedToEventId",render:e=>{let{field:t}=e;return(0,a.jsxs)(o.eI,{children:[(0,a.jsx)(o.lR,{children:"Assign to Event ID (Optional)"}),(0,a.jsx)(o.MJ,{children:(0,a.jsx)(c.p,{placeholder:"e.g., event123",...t})}),(0,a.jsx)(o.Rr,{children:"Link this expense to a specific event."}),(0,a.jsx)(o.C5,{})]})}}),(0,a.jsx)(o.zB,{control:eO.control,name:"assignedToMenuId",render:e=>{let{field:t}=e;return(0,a.jsxs)(o.eI,{children:[(0,a.jsx)(o.lR,{children:"Assign to Menu ID (Optional)"}),(0,a.jsx)(o.MJ,{children:(0,a.jsx)(c.p,{placeholder:"e.g., menu456",...t})}),(0,a.jsx)(o.Rr,{children:"Link this expense to a specific menu."}),(0,a.jsx)(o.C5,{})]})}})]}),(0,a.jsx)(o.zB,{control:eO.control,name:"notes",render:e=>{let{field:t}=e;return(0,a.jsxs)(o.eI,{children:[(0,a.jsx)(o.lR,{children:"Notes (Optional)"}),(0,a.jsx)(o.MJ,{children:(0,a.jsx)(u.T,{placeholder:"e.g., Specific items, reason for expense",...t})}),(0,a.jsx)(o.C5,{})]})}}),(0,a.jsxs)(Q,{children:[(0,a.jsx)(ee,{asChild:!0,children:(0,a.jsx)(d.$,{type:"button",variant:"outline",disabled:Y||ey,children:"Cancel"})}),(0,a.jsx)(d.$,{type:"submit",disabled:Y||ey,children:Y?(0,a.jsx)(I.A,{className:"mr-2 h-4 w-4 animate-spin"}):eo?"Save Changes":"Add Receipt"})]})]})})]})}),eu&&es&&H&&X&&K&&Q&&ee&&(0,a.jsx)(es,{open:eu,onOpenChange:e=>{var t;!e&&(null==(t=ek.current)?void 0:t.srcObject)&&(ek.current.srcObject.getTracks().forEach(e=>e.stop()),ek.current.srcObject=null,eh(null)),em(e),e||eb(!1)},children:(0,a.jsxs)(H,{className:"sm:max-w-md",children:[(0,a.jsx)(X,{children:(0,a.jsx)(K,{children:"Capture Receipt with Camera"})}),!1===ep&&(0,a.jsxs)(g.Fc,{variant:"destructive",children:[(0,a.jsx)(g.XL,{children:"Camera Access Required"}),(0,a.jsx)(g.TN,{children:"Please allow camera access in your browser settings to use this feature. You might need to refresh the page after granting permission."})]}),(0,a.jsx)("video",{ref:ek,className:(0,v.cn)("w-full aspect-video rounded-md bg-muted",{hidden:ev}),autoPlay:!0,playsInline:!0,muted:!0,"data-ai-hint":"camera feed"}),(0,a.jsx)("canvas",{ref:eD,className:"hidden"}),ev&&ex&&(0,a.jsx)(B.default,{src:ex,alt:"Captured receipt",width:400,height:300,className:"rounded-md object-contain mx-auto border","data-ai-hint":"receipt scan"}),(0,a.jsx)(Q,{className:"sm:justify-between mt-2",children:ev?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.$,{type:"button",variant:"outline",onClick:()=>{eb(!1),ef(null),ej(null),eh(null)},children:"Retake"}),(0,a.jsx)(d.$,{type:"button",onClick:()=>{em(!1),eb(!1)},children:"Use This Image"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ee,{asChild:!0,children:(0,a.jsx)(d.$,{type:"button",variant:"outline",children:"Cancel"})}),(0,a.jsx)(d.$,{type:"button",onClick:()=>{if(ek.current&&eD.current){let t=ek.current,s=eD.current;s.width=t.videoWidth,s.height=t.videoHeight;let a=s.getContext("2d");if(a){var e;a.drawImage(t,0,0,s.width,s.height),ef(s.toDataURL("image/jpeg")),ej("cam_capture_".concat(Date.now(),".jpg")),eb(!0),(null==(e=ek.current)?void 0:e.srcObject)&&(ek.current.srcObject.getTracks().forEach(e=>e.stop()),ek.current.srcObject=null),eh(null)}}},disabled:!0!==ep,children:"Capture Photo"})]})})]})}),ew&&Z&&H&&X&&K&&Q&&ee&&(0,a.jsx)(Z,{open:ew,onOpenChange:eA,children:(0,a.jsxs)(H,{className:"sm:max-w-lg",children:[(0,a.jsxs)(X,{children:[(0,a.jsx)(K,{children:"AI Tax Advice Assistant"}),et&&(0,a.jsx)(et,{children:"Ask a tax-related question based on your region. This is not professional advice."})]}),(0,a.jsx)(o.lV,{...eB,children:(0,a.jsxs)("form",{onSubmit:eB.handleSubmit(eZ),className:"space-y-4",children:[(0,a.jsx)(o.zB,{control:eB.control,name:"region",render:e=>{let{field:t}=e;return(0,a.jsxs)(o.eI,{children:[(0,a.jsx)(o.lR,{children:"Your Country/Region"}),(0,a.jsx)(o.MJ,{children:(0,a.jsx)(c.p,{placeholder:"e.g., Australia, California, UK",...t})}),(0,a.jsx)(o.C5,{})]})}}),(0,a.jsx)(o.zB,{control:eB.control,name:"query",render:e=>{let{field:t}=e;return(0,a.jsxs)(o.eI,{children:[(0,a.jsx)(o.lR,{children:"Your Tax Question"}),(0,a.jsx)(o.MJ,{children:(0,a.jsx)(u.T,{placeholder:"e.g., What are common tax deductions for private chefs?",...t})}),(0,a.jsx)(o.C5,{})]})}}),(0,a.jsxs)(d.$,{type:"submit",disabled:eR,className:"w-full",children:[eR?(0,a.jsx)(I.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,a.jsx)(k.A,{className:"mr-2 h-4 w-4"}),eR?"Getting Advice...":"Ask AI"]})]})}),eC&&(0,a.jsxs)("div",{className:"mt-6 space-y-3 rounded-md border bg-muted/50 p-4",children:[(0,a.jsx)("h4",{className:"font-semibold",children:"AI Response:"}),(0,a.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:eC.advice}),(0,a.jsx)("p",{className:"text-xs italic text-muted-foreground",children:eC.disclaimer})]}),(0,a.jsx)(Q,{className:"mt-4",children:(0,a.jsx)(ee,{asChild:!0,children:(0,a.jsx)(d.$,{type:"button",variant:"outline",children:"Close"})})})]})}),(0,a.jsxs)(p.Zp,{children:[(0,a.jsx)(p.aR,{children:(0,a.jsx)(p.ZB,{children:"Expenses Summary"})}),(0,a.jsx)(p.Wu,{children:i&&0===eV.length?(0,a.jsxs)("div",{className:"flex justify-center items-center py-8",children:[(0,a.jsx)(I.A,{className:"h-6 w-6 animate-spin text-primary","data-ai-hint":"loading icon"}),(0,a.jsx)("p",{className:"ml-2",children:"Loading summary..."})]}):0===eV.length&&t.length>0?(0,a.jsx)("p",{className:"text-muted-foreground text-center py-4",children:"No receipts match the current filters."}):(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold mb-2",children:"By Cost Type (Filtered):"}),Object.entries(eY).map(e=>{let[t,s]=e;return(null!=s?s:0)>0&&(0,a.jsxs)("div",{className:"flex justify-between text-sm py-1 border-b last:border-b-0",children:[(0,a.jsxs)("span",{children:[t,":"]}),(0,a.jsxs)("span",{className:"font-medium",children:["$",(null!=s?s:0).toFixed(2)]})]},t)}),Object.values(eY).every(e=>(null!=e?e:0)===0)&&eV.length>0&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"No expenses for selected filters in these cost types."}),0===eV.length&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"No expenses to summarize."})]}),(0,a.jsxs)("div",{className:"flex flex-col justify-end items-end pt-4 md:pt-0",children:[(0,a.jsxs)("div",{className:"text-lg font-semibold flex items-center",children:[(0,a.jsx)(M.A,{className:"mr-1 h-5 w-5 text-green-600","data-ai-hint":"money cost"}),"Total (Filtered): $",eW.toFixed(2)]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Total of ",eV.length," receipt(s) matching filters."]})]})]})})]}),(0,a.jsxs)(p.Zp,{children:[(0,a.jsx)(p.aR,{children:(0,a.jsx)(p.ZB,{children:"Uploaded Receipts"})}),(0,a.jsx)(p.Wu,{children:i&&0===t.length?(0,a.jsxs)("div",{className:"flex justify-center items-center py-8",children:[(0,a.jsx)(I.A,{className:"h-6 w-6 animate-spin text-primary","data-ai-hint":"loading data"}),(0,a.jsx)("p",{className:"ml-2",children:"Loading receipts..."})]}):eV.length>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(m.XI,{children:[(0,a.jsx)(m.A0,{children:(0,a.jsxs)(m.Hj,{children:[(0,a.jsx)(m.nd,{children:"Vendor"}),(0,a.jsx)(m.nd,{children:"Date"}),(0,a.jsx)(m.nd,{className:"text-right",children:"Amount"}),(0,a.jsx)(m.nd,{children:"Cost Type"}),(0,a.jsx)(m.nd,{children:"Assigned To"}),(0,a.jsx)(m.nd,{children:"File/Notes"}),(0,a.jsx)(m.nd,{className:"text-right w-[120px]",children:"Actions"})]})}),(0,a.jsx)(m.BF,{children:eV.map(e=>(0,a.jsxs)(m.Hj,{children:[(0,a.jsx)(m.nA,{className:"font-medium",children:e.vendor}),(0,a.jsx)(m.nA,{children:e.date&&(0,y.f)(new Date(e.date))?(0,C.GP)(new Date(e.date),"PP"):"N/A"}),(0,a.jsxs)(m.nA,{className:"text-right",children:["$",e.totalAmount.toFixed(2)]}),(0,a.jsx)(m.nA,{children:e.costType}),(0,a.jsxs)(m.nA,{className:"text-xs",children:[e.assignedToEventId&&(0,a.jsxs)("div",{children:["Event: ",e.assignedToEventId.substring(0,8),"..."]}),e.assignedToMenuId&&(0,a.jsxs)("div",{children:["Menu: ",e.assignedToMenuId.substring(0,8),"..."]})]}),(0,a.jsxs)(m.nA,{className:"text-xs text-muted-foreground truncate max-w-[150px] sm:max-w-[200px]",children:[e.fileName&&(0,a.jsx)("div",{className:"font-medium text-foreground",children:e.fileName.length>20?e.fileName.substring(0,17)+"...":e.fileName}),e.imageUrl&&(0,a.jsx)("a",{href:e.imageUrl,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-500 hover:underline",children:"(View Image)"}),e.notes&&(0,a.jsx)("div",{className:"italic",children:e.notes.length>30?e.notes.substring(0,27)+"...":e.notes})]}),(0,a.jsx)(m.nA,{className:"text-right",children:(0,a.jsxs)("div",{className:"flex justify-end space-x-1",children:[(0,a.jsxs)(d.$,{variant:"ghost",size:"icon",onClick:()=>eq(e),className:"mr-1",disabled:Y||ey,children:[(0,a.jsx)(U.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Edit"})]}),(0,a.jsxs)(d.$,{variant:"ghost",size:"icon",onClick:()=>eJ(e.id),className:"text-destructive hover:text-destructive",disabled:Y||ey,children:[(0,a.jsx)(_.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Delete"})]})]})})]},e.id))})]})}):(0,a.jsx)("p",{className:"text-muted-foreground text-center py-8",children:0===t.length?"No receipts uploaded yet. Start by adding your first expense!":"No receipts match the current filters. Try adjusting or clearing them."})})]}),(0,a.jsxs)(p.Zp,{className:"mt-8",children:[(0,a.jsx)(p.aR,{children:(0,a.jsx)(p.ZB,{children:"Financial Tools & Future Features"})}),(0,a.jsxs)(p.Wu,{className:"space-y-3 text-sm text-muted-foreground",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Event Profitability:"})," In the future, you'll be able to filter receipts by Event ID to see specific cost breakdowns and calculate profitability for each event."]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Invoice Generation:"})," Upon event completion and confirmation, invoices will be automatically generated for both you and the customer, accessible through your respective dashboards."]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"AI Cost Insights:"})," We're working on AI tools to provide deeper insights into your spending patterns, helping you optimize menu pricing and purchasing."]})]})]}),(0,a.jsxs)(g.Fc,{className:"mt-8",children:[(0,a.jsx)(L.A,{className:"h-4 w-4","data-ai-hint":"info icon"}),(0,a.jsx)(g.XL,{children:"Payout & Financial Information"}),(0,a.jsx)(g.TN,{children:(0,a.jsxs)("ul",{className:"list-disc list-inside text-xs space-y-1",children:[(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Initial Fund Distribution:"})," Upon customer booking confirmation and payment, 46% of the event cost is released to the chef and 4% to FindAChef immediately (requires backend Stripe Connect integration)."]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Escrow & Final Release:"})," The remaining 50% is held. This portion is released to the chef after the event is confirmed complete by the customer (e.g., via QR code scan at the event, requires backend)."]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Public Ticketed Events:"})," For events you host and sell tickets for via The Chef's Wall, payouts are generally scheduled 7 days *before* the event date to assist with upfront costs (subject to terms, requires backend logic)."]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Cancellations by Chef:"})," If a chef cancels an event, a full refund is issued to the customer. Admin will be notified to assist and manage chef accountability, which may include penalties if a replacement cannot be found."]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Cancellations by Customer:"}),(0,a.jsxs)("ul",{className:"list-['-_'] list-inside ml-4",children:[(0,a.jsx)("li",{children:"If a customer cancels more than 20 days before the event, a 50% refund is typically processed."}),(0,a.jsx)("li",{children:"If a customer cancels less than 20 days before the event, a 20% refund is processed. In this case, 15% of the total event cost may go to the chef and 15% to FindAChef (subject to terms)."}),(0,a.jsxs)("li",{children:["Refer to the full ",(0,a.jsx)(Link,{href:"/terms#cancellation",className:"underline hover:text-primary",children:"Terms of Service"})," for complete cancellation policy details."]})]})]}),(0,a.jsx)("li",{children:"Always ensure all receipts for an event are uploaded promptly for accurate cost tracking and potential tax purposes."})]})})]}),(0,a.jsx)("div",{className:"flex justify-end mt-6",children:(0,a.jsxs)(d.$,{onClick:()=>{if(0===eV.length)return void eL({title:"No Data",description:"Receipt list (with current filters) is empty.",variant:"default"});let e=new Blob([["Vendor,Date,Total Amount,Cost Type,Assigned to Event ID,Assigned to Menu ID,Notes,File Name,Image URL",...eV.map(e=>{let t="";if(e.date){let s=e.date instanceof J.Dc?e.date.toDate():new Date(e.date);(0,y.f)(s)&&(t=(0,C.GP)(s,"yyyy-MM-dd"))}return['"'.concat((e.vendor||"").replace(/"/g,'""'),'"'),t,e.totalAmount.toFixed(2),'"'.concat((e.costType||"").replace(/"/g,'""'),'"'),'"'.concat((e.assignedToEventId||"").replace(/"/g,'""'),'"'),'"'.concat((e.assignedToMenuId||"").replace(/"/g,'""'),'"'),'"'.concat((e.notes||"").replace(/"/g,'""'),'"'),'"'.concat((e.fileName||"").replace(/"/g,'""'),'"'),'"'.concat((e.imageUrl||"").replace(/"/g,'""'),'"')].join(",")})].join("\n")],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a");if(void 0!==t.download){let s=URL.createObjectURL(e);t.setAttribute("href",s),t.setAttribute("download","filtered_receipts_export.csv"),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(s)}eL({title:"Export Successful",description:"Filtered receipts exported to CSV."})},variant:"outline",disabled:0===eV.length||i,children:[(0,a.jsx)(O.A,{className:"mr-2 h-5 w-5"})," Export Filtered Data (CSV)"]})})]})}},88539:(e,t,s)=>{"use strict";s.d(t,{T:()=>l});var a=s(95155),r=s(12115),n=s(59434);let l=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("textarea",{className:(0,n.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...r})});l.displayName="Textarea"}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,7446,9352,4453,4602,1345,6766,65,1342,106,5740,5388,7576,4314,45,4534,8226,8441,1684,7358],()=>t(17763)),_N_E=e.O()}]);