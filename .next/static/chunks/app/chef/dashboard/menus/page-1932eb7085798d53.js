(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9667],{15263:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>C});var a=i(95155),n=i(12115),s=i(90221),r=i(62177),o=i(55594),d=i(30285),l=i(17759),u=i(66695),c=i(76252),m=i(87481),p=i(51154),g=i(49523),f=i(49103),h=i(59576),b=i(56104),x=i(35317),v=i(90858),y=i(34477);y.callServer,y.findSourceMapURL;var I=i(79737),j=i(55028);let w=(0,j.default)(()=>Promise.all([i.e(1345),i.e(4165)]).then(i.bind(i,54165)).then(e=>e.Dialog),{loadableGenerated:{webpack:()=>[54165]},ssr:!1}),A=(0,j.default)(()=>Promise.all([i.e(1345),i.e(4165)]).then(i.bind(i,54165)).then(e=>e.DialogContent),{loadableGenerated:{webpack:()=>[54165]},ssr:!1}),N=(0,j.default)(()=>Promise.all([i.e(1345),i.e(4165)]).then(i.bind(i,54165)).then(e=>e.DialogHeader),{loadableGenerated:{webpack:()=>[54165]},ssr:!1}),P=(0,j.default)(()=>Promise.all([i.e(1345),i.e(4165)]).then(i.bind(i,54165)).then(e=>e.DialogTitle),{loadableGenerated:{webpack:()=>[54165]},ssr:!1}),M=(0,j.default)(()=>Promise.all([i.e(1345),i.e(4165)]).then(i.bind(i,54165)).then(e=>e.DialogFooter),{loadableGenerated:{webpack:()=>[54165]},ssr:!1}),S=(0,j.default)(()=>Promise.all([i.e(1345),i.e(4165)]).then(i.bind(i,54165)).then(e=>e.DialogClose),{loadableGenerated:{webpack:()=>[54165]},ssr:!1});(0,j.default)(()=>Promise.all([i.e(1345),i.e(4165)]).then(i.bind(i,54165)).then(e=>e.DialogDescription),{loadableGenerated:{webpack:()=>[54165]},ssr:!1});let D=o.Ik({id:o.Yj(),name:o.Yj().min(1,{message:"Ingredient name is required."}),quantity:o.au.number().min(.01,{message:"Quantity must be positive."}),unit:o.Yj().min(1,{message:"Unit is required."}),costPerUnit:o.au.number().min(0,{message:"Cost per unit must be non-negative."}),totalCost:o.au.number().optional(),notes:o.Yj().optional()}).strip(),E=o.Ik({title:o.Yj().min(3,{message:"Title must be at least 3 characters."}),description:o.Yj().min(10,{message:"Description must be at least 10 characters."}),cuisine:o.Yj().min(2,{message:"Cuisine type is required."}),pricePerHead:o.au.number().min(0,{message:"Sale price must be a positive number."}),pax:o.au.number().min(1,{message:"PAX must be at least 1."}).optional(),costPrice:o.au.number().min(0,{message:"Cost price must be positive."}).optional(),dietaryInfo:o.YO(o.Yj()).optional(),isPublic:o.zM().default(!1),menuImageFile:o.Nl(File).optional().refine(e=>!e||e.size<=2097152,"Max image size is 2MB.").refine(e=>!e||["image/jpeg","image/png","image/webp"].includes(e.type),"Only JPG, PNG, WEBP files are allowed."),dataAiHint:o.Yj().optional().max(30,"Hint should be brief, max 2 words."),menuIngredients:o.YO(D).default([])}).refine(e=>!e.isPublic||!!e.menuIngredients&&0!==e.menuIngredients.length,{message:"Public menus must have at least one ingredient listed.",path:["isPublic"]});function C(){let{user:e,userProfile:t,isChefSubscribed:i,loading:o}=(0,h.A)(),[y,j]=(0,n.useState)([]),[D,C]=(0,n.useState)(!0),[T,O]=(0,n.useState)(!1),[F,k]=(0,n.useState)(!1),[_,Y]=(0,n.useState)(null),[R,H]=(0,n.useState)(null),[G,U]=(0,n.useState)(null),[q,L]=(0,n.useState)(!1),{toast:J}=(0,m.dj)(),z=(0,r.mN)({resolver:(0,s.u)(E),defaultValues:{title:"",description:"",cuisine:"",pricePerHead:0,dietaryInfo:[],isPublic:!1,menuImageFile:void 0,pax:1,costPrice:0,dataAiHint:"",menuIngredients:[]}}),{fields:V,append:B,remove:W,replace:X}=(0,r.jz)({control:z.control,name:"menuIngredients"}),Q=z.watch("menuIngredients"),Z=z.watch("pax"),$=(0,n.useMemo)(()=>(null==Q?void 0:Q.reduce((e,t)=>e+(Number(t.quantity)||0)*(Number(t.costPerUnit)||0),0))||0,[Q]);(0,n.useMemo)(()=>$/Math.max(1,Number(Z)||1),[$,Z]),(0,n.useEffect)(()=>{if(o||!e){C(!1),o||e||j([]);return}C(!0);let t=(0,x.rJ)(b.db,"menus"),i=(0,x.P)(t,(0,x._M)("chefId","==",e.uid),(0,x.My)("createdAt","desc")),a=(0,x.aQ)(i,e=>{j(e.docs.map(e=>{let t=e.data();return{id:e.id,...t,createdAt:t.createdAt instanceof x.Dc?t.createdAt.toDate():t.createdAt?new Date(t.createdAt):void 0,updatedAt:t.updatedAt instanceof x.Dc?t.updatedAt.toDate():t.updatedAt?new Date(t.updatedAt):void 0}})),C(!1)},e=>{console.error("MenuManagementPage: Error fetching menus:",e),J({title:"Error Fetching Menus",description:"Could not fetch your menus.",variant:"destructive"}),j([]),C(!1)});return()=>a()},[e,o,J]);let K=e=>{let t=y.find(t=>t.id===e);if(t){var i;Y(t),z.reset({title:t.title,description:t.description,cuisine:t.cuisine,pricePerHead:t.pricePerHead||0,pax:t.pax||1,costPrice:t.costPrice||0,dietaryInfo:t.dietaryInfo||[],isPublic:t.isPublic,menuImageFile:void 0,dataAiHint:t.dataAiHint||"",menuIngredients:(null==(i=t.menuIngredients)?void 0:i.map(e=>({...e,id:e.id||(0,I.A)()})))||[]}),U(t.imageUrl||null),H(null),k(!0)}},ee=async t=>{if(!e)return void J({title:"Authentication Error",description:"You must be logged in.",variant:"destructive"});let i=y.find(e=>e.id===t);if(!i)return void J({title:"Error",description:"Menu not found.",variant:"destructive"});if(window.confirm('Are you sure you want to delete the menu "'.concat(null==i?void 0:i.title,'"?'))){O(!0);try{if(i.imageUrl&&i.imageUrl.startsWith("https://firebasestorage.googleapis.com"))try{let e=(0,v.KR)(b.IG,i.imageUrl);await (0,v.XR)(e)}catch(e){"storage/object-not-found"!==e.code&&console.warn("MenuManagementPage: Could not delete menu image from storage during menu deletion:",e.message)}await (0,x.kd)((0,x.H9)(b.db,"menus",t)),J({title:"Menu Deleted",description:'"'.concat(null==i?void 0:i.title,'" has been deleted.'),variant:"destructive"})}catch(e){console.error("MenuManagementPage: Error deleting menu:",e),J({title:"Delete Error",description:"Could not delete menu: ".concat(e.message),variant:"destructive"})}finally{O(!1)}}},et=(0,n.useCallback)(async t=>{if(!e)return void J({title:"Not Logged In",description:"Please log in to add items to your shopping list.",variant:"destructive"});if(!t.menuIngredients||0===t.menuIngredients.length)return void J({title:"No Ingredients",description:"This menu has no ingredients listed to add to the shopping list.",variant:"default"});O(!0);try{let i=(0,x.wP)(b.db),a=(0,x.rJ)(b.db,"users/".concat(e.uid,"/shoppingListItems"));t.menuIngredients.forEach(n=>{if(!n.name||!n.quantity||!n.unit)return;let s=(0,x.H9)(a),r={chefId:e.uid,name:n.name,quantity:Number(n.quantity)||1,unit:n.unit,estimatedCost:Number(n.costPerUnit)||0,notes:"For menu: ".concat(t.title,". ").concat(n.notes||"").trim(),purchased:!1,menuId:t.id};i.set(s,{...r,createdAt:(0,x.O5)(),updatedAt:(0,x.O5)()})}),await i.commit(),J({title:"Added to Shopping List",description:'Ingredients from "'.concat(t.title,'" added.')})}catch(e){console.error("MenuManagementPage: Error adding to shopping list:",e),J({title:"Error",description:"Could not add items to shopping list: ".concat(e.message),variant:"destructive"})}finally{O(!1)}},[e,J]),ei=()=>{e&&(z.reset({title:"",description:"",cuisine:"",pricePerHead:0,dietaryInfo:[],isPublic:!1,menuImageFile:void 0,pax:1,costPrice:0,dataAiHint:"",menuIngredients:[]}),Y(null),H(null),U(null),X([]),k(!0))};return o||D&&e?(0,a.jsxs)("div",{className:"flex justify-center items-center h-64",children:[(0,a.jsx)(p.A,{className:"h-8 w-8 animate-spin text-primary","data-ai-hint":"loading spinner"}),(0,a.jsx)("p",{className:"ml-2",children:"Loading your menus..."})]}):e?(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-2",children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold flex items-center",children:[(0,a.jsx)(g.A,{className:"mr-3 h-8 w-8 text-primary","data-ai-hint":"notebook icon"})," Manage Your Menus"]}),(0,a.jsxs)(d.$,{onClick:ei,disabled:T||q,children:[(0,a.jsx)(f.A,{className:"mr-2 h-5 w-5"})," Add New Menu"]})]}),F&&w&&A&&N&&P&&M&&S&&(0,a.jsx)(w,{open:F,onOpenChange:e=>{(T||q)&&e||(k(e),e||(H(null),U(null),z.reset(),Y(null),X([])))},children:(0,a.jsxs)(A,{className:"sm:max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)(N,{children:(0,a.jsx)(P,{children:_?"Edit Menu":"Create New Menu"})}),(0,a.jsx)(l.lV,{...z})]})}),y.length>0?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:y.map(e=>(0,a.jsx)(c.Y,{menu:e,onEdit:()=>K(e.id),onDelete:()=>ee(e.id),onAddToShoppingList:et,isChefOwner:!0,showChefDetails:!1},e.id))}):!D&&(0,a.jsxs)(u.Zp,{className:"text-center py-12 border-dashed",children:[(0,a.jsxs)(u.aR,{children:[(0,a.jsx)(g.A,{className:"mx-auto h-12 w-12 text-muted-foreground mb-3","data-ai-hint":"notebook empty"}),(0,a.jsx)(u.ZB,{children:"No Menus Yet"})]}),(0,a.jsxs)(u.Wu,{children:[(0,a.jsx)("p",{className:"text-muted-foreground mb-4",children:"You haven't created any menus. Get started by adding your first one!"}),(0,a.jsxs)(d.$,{onClick:ei,disabled:T||q,children:[(0,a.jsx)(f.A,{className:"mr-2 h-5 w-5"})," Create Your First Menu"]})]})]})]}):(0,a.jsx)("div",{className:"text-center py-10 text-muted-foreground",children:"Please log in to manage your menus."})}},17759:(e,t,i)=>{"use strict";i.d(t,{C5:()=>x,MJ:()=>h,Rr:()=>b,eI:()=>g,lR:()=>f,lV:()=>l,zB:()=>c});var a=i(95155),n=i(12115),s=i(99708),r=i(62177),o=i(59434),d=i(85057);let l=r.Op,u=n.createContext({}),c=e=>{let{...t}=e;return(0,a.jsx)(u.Provider,{value:{name:t.name},children:(0,a.jsx)(r.xI,{...t})})},m=()=>{let e=n.useContext(u),t=n.useContext(p),{getFieldState:i,formState:a}=(0,r.xW)(),s=i(e.name,a);if(!e)throw Error("useFormField should be used within <FormField>");let{id:o}=t;return{id:o,name:e.name,formItemId:"".concat(o,"-form-item"),formDescriptionId:"".concat(o,"-form-item-description"),formMessageId:"".concat(o,"-form-item-message"),...s}},p=n.createContext({}),g=n.forwardRef((e,t)=>{let{className:i,...s}=e,r=n.useId();return(0,a.jsx)(p.Provider,{value:{id:r},children:(0,a.jsx)("div",{ref:t,className:(0,o.cn)("space-y-2",i),...s})})});g.displayName="FormItem";let f=n.forwardRef((e,t)=>{let{className:i,...n}=e,{error:s,formItemId:r}=m();return(0,a.jsx)(d.J,{ref:t,className:(0,o.cn)(s&&"text-destructive",i),htmlFor:r,...n})});f.displayName="FormLabel";let h=n.forwardRef((e,t)=>{let{...i}=e,{error:n,formItemId:r,formDescriptionId:o,formMessageId:d}=m();return(0,a.jsx)(s.DX,{ref:t,id:r,"aria-describedby":n?"".concat(o," ").concat(d):"".concat(o),"aria-invalid":!!n,...i})});h.displayName="FormControl";let b=n.forwardRef((e,t)=>{let{className:i,...n}=e,{formDescriptionId:s}=m();return(0,a.jsx)("p",{ref:t,id:s,className:(0,o.cn)("text-sm text-muted-foreground",i),...n})});b.displayName="FormDescription";let x=n.forwardRef((e,t)=>{var i;let{className:n,children:s,...r}=e,{error:d,formMessageId:l}=m(),u=d?String(null!=(i=null==d?void 0:d.message)?i:""):s;return u?(0,a.jsx)("p",{ref:t,id:l,className:(0,o.cn)("text-sm font-medium text-destructive",n),...r,children:u}):null});x.displayName="FormMessage"},40452:(e,t,i)=>{Promise.resolve().then(i.bind(i,15263))},85057:(e,t,i)=>{"use strict";i.d(t,{J:()=>l});var a=i(95155),n=i(12115),s=i(40968),r=i(74466),o=i(59434);let d=(0,r.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),l=n.forwardRef((e,t)=>{let{className:i,...n}=e;return(0,a.jsx)(s.b,{ref:t,className:(0,o.cn)(d(),i),...n})});l.displayName=s.b.displayName},87481:(e,t,i)=>{"use strict";i.d(t,{dj:()=>m});var a=i(12115);let n=0,s=new Map,r=e=>{if(s.has(e))return;let t=setTimeout(()=>{s.delete(e),u({type:"REMOVE_TOAST",toastId:e})},1e6);s.set(e,t)},o=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:i}=t;return i?r(i):e.toasts.forEach(e=>{r(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===i||void 0===i?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},d=[],l={toasts:[]};function u(e){l=o(l,e),d.forEach(e=>{e(l)})}function c(e){let{...t}=e,i=(n=(n+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>u({type:"DISMISS_TOAST",toastId:i});return u({type:"ADD_TOAST",toast:{...t,id:i,open:!0,onOpenChange:e=>{e||a()}}}),{id:i,dismiss:a,update:e=>u({type:"UPDATE_TOAST",toast:{...e,id:i}})}}function m(){let[e,t]=a.useState(l);return a.useEffect(()=>(d.push(t),()=>{let e=d.indexOf(t);e>-1&&d.splice(e,1)}),[e]),{...e,toast:c,dismiss:e=>u({type:"DISMISS_TOAST",toastId:e})}}}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,7446,9352,5100,4602,6766,7322,5816,4123,8441,1684,7358],()=>t(40452)),_N_E=e.O()}]);