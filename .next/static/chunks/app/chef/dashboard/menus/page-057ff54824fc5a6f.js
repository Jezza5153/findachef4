(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9667],{15263:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>E});var a=n(95155),i=n(12115),s=n(90221),r=n(62177),d=n(55594),o=n(30285),l=n(17759),u=n(66695),c=n(76252),m=n(87481),p=n(51154),g=n(49523),f=n(49103),h=n(59576),x=n(56104),b=n(35317),v=n(90858),y=n(34477);y.callServer,y.findSourceMapURL;var I=n(79737),w=n(55028);let j=(0,w.default)(()=>Promise.all([n.e(1345),n.e(4165)]).then(n.bind(n,54165)).then(e=>e.Dialog),{loadableGenerated:{webpack:()=>[54165]},ssr:!1}),A=(0,w.default)(()=>Promise.all([n.e(1345),n.e(4165)]).then(n.bind(n,54165)).then(e=>e.DialogContent),{loadableGenerated:{webpack:()=>[54165]},ssr:!1}),N=(0,w.default)(()=>Promise.all([n.e(1345),n.e(4165)]).then(n.bind(n,54165)).then(e=>e.DialogHeader),{loadableGenerated:{webpack:()=>[54165]},ssr:!1}),P=(0,w.default)(()=>Promise.all([n.e(1345),n.e(4165)]).then(n.bind(n,54165)).then(e=>e.DialogTitle),{loadableGenerated:{webpack:()=>[54165]},ssr:!1}),M=(0,w.default)(()=>Promise.all([n.e(1345),n.e(4165)]).then(n.bind(n,54165)).then(e=>e.DialogFooter),{loadableGenerated:{webpack:()=>[54165]},ssr:!1}),S=(0,w.default)(()=>Promise.all([n.e(1345),n.e(4165)]).then(n.bind(n,54165)).then(e=>e.DialogClose),{loadableGenerated:{webpack:()=>[54165]},ssr:!1});(0,w.default)(()=>Promise.all([n.e(1345),n.e(4165)]).then(n.bind(n,54165)).then(e=>e.DialogDescription),{loadableGenerated:{webpack:()=>[54165]},ssr:!1});let D=d.Ik({id:d.Yj(),name:d.Yj().min(1,{message:"Ingredient name is required."}),quantity:d.au.number().min(.01,{message:"Quantity must be positive."}),unit:d.Yj().min(1,{message:"Unit is required."}),costPerUnit:d.au.number().min(0,{message:"Cost per unit must be non-negative."}),totalCost:d.au.number().optional(),notes:d.Yj().max().optional()}).strip();function E(){let{user:e,userProfile:t,isChefSubscribed:n,loading:d}=(0,h.A)(),[y,w]=(0,i.useState)([]),[D,E]=(0,i.useState)(!0),[C,T]=(0,i.useState)(!1),[F,O]=(0,i.useState)(!1),[k,_]=(0,i.useState)(null),[R,H]=(0,i.useState)(null),[G,Y]=(0,i.useState)(null),[U,q]=(0,i.useState)(!1),{toast:L}=(0,m.dj)(),J=(0,r.mN)({resolver:(0,s.u)(menuFormSchema),defaultValues:{title:"",description:"",cuisine:"",pricePerHead:0,dietaryInfo:[],isPublic:!1,menuImageFile:void 0,pax:1,costPrice:0,dataAiHint:"",menuIngredients:[]}}),{fields:V,append:z,remove:B,replace:W}=(0,r.jz)({control:J.control,name:"menuIngredients"}),X=J.watch("menuIngredients"),Q=J.watch("pax"),Z=(0,i.useMemo)(()=>(null==X?void 0:X.reduce((e,t)=>e+(Number(t.quantity)||0)*(Number(t.costPerUnit)||0),0))||0,[X]);(0,i.useMemo)(()=>Z/Math.max(1,Number(Q)||1),[Z,Q]),(0,i.useEffect)(()=>{if(d||!e){E(!1),d||e||w([]);return}E(!0);let t=(0,b.rJ)(x.db,"menus"),n=(0,b.P)(t,(0,b._M)("chefId","==",e.uid),(0,b.My)("createdAt","desc")),a=(0,b.aQ)(n,e=>{w(e.docs.map(e=>{let t=e.data();return{id:e.id,...t,createdAt:t.createdAt instanceof b.Dc?t.createdAt.toDate():t.createdAt?new Date(t.createdAt):void 0,updatedAt:t.updatedAt instanceof b.Dc?t.updatedAt.toDate():t.updatedAt?new Date(t.updatedAt):void 0}})),E(!1)},e=>{console.error("MenuManagementPage: Error fetching menus:",e),L({title:"Error Fetching Menus",description:"Could not fetch your menus.",variant:"destructive"}),w([]),E(!1)});return()=>a()},[e,d,L]);let $=e=>{let t=y.find(t=>t.id===e);if(t){var n;_(t),J.reset({title:t.title,description:t.description,cuisine:t.cuisine,pricePerHead:t.pricePerHead||0,pax:t.pax||1,costPrice:t.costPrice||0,dietaryInfo:t.dietaryInfo||[],isPublic:t.isPublic,menuImageFile:void 0,dataAiHint:t.dataAiHint||"",menuIngredients:(null==(n=t.menuIngredients)?void 0:n.map(e=>({...e,id:e.id||(0,I.A)()})))||[]}),Y(t.imageUrl||null),H(null),O(!0)}},K=async t=>{if(!e)return void L({title:"Authentication Error",description:"You must be logged in.",variant:"destructive"});let n=y.find(e=>e.id===t);if(!n)return void L({title:"Error",description:"Menu not found.",variant:"destructive"});if(window.confirm('Are you sure you want to delete the menu "'.concat(null==n?void 0:n.title,'"?'))){T(!0);try{if(n.imageUrl&&n.imageUrl.startsWith("https://firebasestorage.googleapis.com"))try{let e=(0,v.KR)(x.IG,n.imageUrl);await (0,v.XR)(e)}catch(e){"storage/object-not-found"!==e.code&&console.warn("MenuManagementPage: Could not delete menu image from storage during menu deletion:",e.message)}await (0,b.kd)((0,b.H9)(x.db,"menus",t)),L({title:"Menu Deleted",description:'"'.concat(null==n?void 0:n.title,'" has been deleted.'),variant:"destructive"})}catch(e){console.error("MenuManagementPage: Error deleting menu:",e),L({title:"Delete Error",description:"Could not delete menu: ".concat(e.message),variant:"destructive"})}finally{T(!1)}}},ee=(0,i.useCallback)(async t=>{if(!e)return void L({title:"Not Logged In",description:"Please log in to add items to your shopping list.",variant:"destructive"});if(!t.menuIngredients||0===t.menuIngredients.length)return void L({title:"No Ingredients",description:"This menu has no ingredients listed to add to the shopping list.",variant:"default"});T(!0);try{let n=(0,b.wP)(x.db),a=(0,b.rJ)(x.db,"users/".concat(e.uid,"/shoppingListItems"));t.menuIngredients.forEach(i=>{if(!i.name||!i.quantity||!i.unit)return;let s=(0,b.H9)(a),r={chefId:e.uid,name:i.name,quantity:Number(i.quantity)||1,unit:i.unit,estimatedCost:Number(i.costPerUnit)||0,notes:"For menu: ".concat(t.title,". ").concat(i.notes||"").trim(),purchased:!1,menuId:t.id};n.set(s,{...r,createdAt:(0,b.O5)(),updatedAt:(0,b.O5)()})}),await n.commit(),L({title:"Added to Shopping List",description:'Ingredients from "'.concat(t.title,'" added.')})}catch(e){console.error("MenuManagementPage: Error adding to shopping list:",e),L({title:"Error",description:"Could not add items to shopping list: ".concat(e.message),variant:"destructive"})}finally{T(!1)}},[e,L]),et=()=>{e&&(J.reset({title:"",description:"",cuisine:"",pricePerHead:0,dietaryInfo:[],isPublic:!1,menuImageFile:void 0,pax:1,costPrice:0,dataAiHint:"",menuIngredients:[]}),_(null),H(null),Y(null),W([]),O(!0))};return d||D&&e?(0,a.jsxs)("div",{className:"flex justify-center items-center h-64",children:[(0,a.jsx)(p.A,{className:"h-8 w-8 animate-spin text-primary","data-ai-hint":"loading spinner"}),(0,a.jsx)("p",{className:"ml-2",children:"Loading your menus..."})]}):e?(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-2",children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold flex items-center",children:[(0,a.jsx)(g.A,{className:"mr-3 h-8 w-8 text-primary","data-ai-hint":"notebook icon"})," Manage Your Menus"]}),(0,a.jsxs)(o.$,{onClick:et,disabled:C||U,children:[(0,a.jsx)(f.A,{className:"mr-2 h-5 w-5"})," Add New Menu"]})]}),F&&j&&A&&N&&P&&M&&S&&(0,a.jsx)(j,{open:F,onOpenChange:e=>{(C||U)&&e||(O(e),e||(H(null),Y(null),J.reset(),_(null),W([])))},children:(0,a.jsxs)(A,{className:"sm:max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)(N,{children:(0,a.jsx)(P,{children:k?"Edit Menu":"Create New Menu"})}),(0,a.jsx)(l.lV,{...J})]})}),y.length>0?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:y.map(e=>(0,a.jsx)(c.Y,{menu:e,onEdit:()=>$(e.id),onDelete:()=>K(e.id),onAddToShoppingList:ee,isChefOwner:!0,showChefDetails:!1},e.id))}):!D&&(0,a.jsxs)(u.Zp,{className:"text-center py-12 border-dashed",children:[(0,a.jsxs)(u.aR,{children:[(0,a.jsx)(g.A,{className:"mx-auto h-12 w-12 text-muted-foreground mb-3","data-ai-hint":"notebook empty"}),(0,a.jsx)(u.ZB,{children:"No Menus Yet"})]}),(0,a.jsxs)(u.Wu,{children:[(0,a.jsx)("p",{className:"text-muted-foreground mb-4",children:"You haven't created any menus. Get started by adding your first one!"}),(0,a.jsxs)(o.$,{onClick:et,disabled:C||U,children:[(0,a.jsx)(f.A,{className:"mr-2 h-5 w-5"})," Create Your First Menu"]})]})]})]}):(0,a.jsx)("div",{className:"text-center py-10 text-muted-foreground",children:"Please log in to manage your menus."})}d.Ik({menuImageFile:d.Nl(File).optional().refine(e=>!e||e.size<=2097152,"Max image size is 2MB.").refine(e=>!e||["image/jpeg","image/png","image/webp"].includes(e.type),"Only JPG, PNG, WEBP files are allowed."),dataAiHint:d.Yj().max(40,"Hint should be brief, max 2 words.").optional(),menuIngredients:d.YO(D).default([])}).refine(e=>!e.isPublic||!!e.menuIngredients&&0!==e.menuIngredients.length,{message:"Public menus must have at least one ingredient listed.",path:["isPublic"]})},17759:(e,t,n)=>{"use strict";n.d(t,{C5:()=>b,MJ:()=>h,Rr:()=>x,eI:()=>g,lR:()=>f,lV:()=>l,zB:()=>c});var a=n(95155),i=n(12115),s=n(99708),r=n(62177),d=n(59434),o=n(85057);let l=r.Op,u=i.createContext({}),c=e=>{let{...t}=e;return(0,a.jsx)(u.Provider,{value:{name:t.name},children:(0,a.jsx)(r.xI,{...t})})},m=()=>{let e=i.useContext(u),t=i.useContext(p),{getFieldState:n,formState:a}=(0,r.xW)(),s=n(e.name,a);if(!e)throw Error("useFormField should be used within <FormField>");let{id:d}=t;return{id:d,name:e.name,formItemId:"".concat(d,"-form-item"),formDescriptionId:"".concat(d,"-form-item-description"),formMessageId:"".concat(d,"-form-item-message"),...s}},p=i.createContext({}),g=i.forwardRef((e,t)=>{let{className:n,...s}=e,r=i.useId();return(0,a.jsx)(p.Provider,{value:{id:r},children:(0,a.jsx)("div",{ref:t,className:(0,d.cn)("space-y-2",n),...s})})});g.displayName="FormItem";let f=i.forwardRef((e,t)=>{let{className:n,...i}=e,{error:s,formItemId:r}=m();return(0,a.jsx)(o.J,{ref:t,className:(0,d.cn)(s&&"text-destructive",n),htmlFor:r,...i})});f.displayName="FormLabel";let h=i.forwardRef((e,t)=>{let{...n}=e,{error:i,formItemId:r,formDescriptionId:d,formMessageId:o}=m();return(0,a.jsx)(s.DX,{ref:t,id:r,"aria-describedby":i?"".concat(d," ").concat(o):"".concat(d),"aria-invalid":!!i,...n})});h.displayName="FormControl";let x=i.forwardRef((e,t)=>{let{className:n,...i}=e,{formDescriptionId:s}=m();return(0,a.jsx)("p",{ref:t,id:s,className:(0,d.cn)("text-sm text-muted-foreground",n),...i})});x.displayName="FormDescription";let b=i.forwardRef((e,t)=>{var n;let{className:i,children:s,...r}=e,{error:o,formMessageId:l}=m(),u=o?String(null!=(n=null==o?void 0:o.message)?n:""):s;return u?(0,a.jsx)("p",{ref:t,id:l,className:(0,d.cn)("text-sm font-medium text-destructive",i),...r,children:u}):null});b.displayName="FormMessage"},40452:(e,t,n)=>{Promise.resolve().then(n.bind(n,15263))},85057:(e,t,n)=>{"use strict";n.d(t,{J:()=>l});var a=n(95155),i=n(12115),s=n(40968),r=n(74466),d=n(59434);let o=(0,r.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),l=i.forwardRef((e,t)=>{let{className:n,...i}=e;return(0,a.jsx)(s.b,{ref:t,className:(0,d.cn)(o(),n),...i})});l.displayName=s.b.displayName},87481:(e,t,n)=>{"use strict";n.d(t,{dj:()=>m});var a=n(12115);let i=0,s=new Map,r=e=>{if(s.has(e))return;let t=setTimeout(()=>{s.delete(e),u({type:"REMOVE_TOAST",toastId:e})},1e6);s.set(e,t)},d=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:n}=t;return n?r(n):e.toasts.forEach(e=>{r(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===n||void 0===n?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},o=[],l={toasts:[]};function u(e){l=d(l,e),o.forEach(e=>{e(l)})}function c(e){let{...t}=e,n=(i=(i+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>u({type:"DISMISS_TOAST",toastId:n});return u({type:"ADD_TOAST",toast:{...t,id:n,open:!0,onOpenChange:e=>{e||a()}}}),{id:n,dismiss:a,update:e=>u({type:"UPDATE_TOAST",toast:{...e,id:n}})}}function m(){let[e,t]=a.useState(l);return a.useEffect(()=>(o.push(t),()=>{let e=o.indexOf(t);e>-1&&o.splice(e,1)}),[e]),{...e,toast:c,dismiss:e=>u({type:"DISMISS_TOAST",toastId:e})}}}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,7446,9352,5100,4602,6766,7322,5816,4123,8441,1684,7358],()=>t(40452)),_N_E=e.O()}]);