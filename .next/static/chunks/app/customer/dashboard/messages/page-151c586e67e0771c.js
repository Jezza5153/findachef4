(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1621],{7824:(e,t,a)=>{Promise.resolve().then(a.bind(a,51723))},51723:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>U});var s=a(95155),r=a(12115),i=a(66695),n=a(62523),l=a(30285),o=a(88539),d=a(91394),c=a(51154),m=a(97108),u=a(47924),p=a(23562),f=a(55868),x=a(81284),h=a(57434),g=a(17576),v=a(40646),N=a(54861),b=a(1243),y=a(12486),j=a(81586),w=a(59576),P=a(56104),k=a(35317),A=a(85388),C=a(87481),D=a(35695),I=a(90010),_=a(7368),E=a(55028);let R=(0,E.default)(()=>Promise.all([a.e(5855).then(a.t.bind(a,55855,23)).then(e=>e.Elements),(0,_.c)("pk_test_YOUR_STRIPE_PUBLISHABLE_KEY")]).then(e=>{let[{Elements:t},a]=e;return{default:e=>{let{children:r}=e;return a?(0,s.jsx)(t,{stripe:a,options:{locale:"en"},children:r}):(0,s.jsxs)("div",{className:"text-center py-4",children:[(0,s.jsx)(c.A,{className:"h-6 w-6 animate-spin mx-auto"})," Initializing Payment Gateway..."]})}}}),{loadableGenerated:{webpack:()=>[55855]},ssr:!1,loading:()=>(0,s.jsxs)("div",{className:"text-center py-4",children:[(0,s.jsx)(c.A,{className:"h-6 w-6 animate-spin mx-auto"})," Initializing Payment Gateway..."]})}),T=(0,E.default)(()=>a.e(1101).then(a.bind(a,1101)).then(e=>e.StripePaymentForm),{loadableGenerated:{webpack:()=>[1101]},ssr:!1,loading:()=>(0,s.jsxs)("div",{className:"text-center py-4",children:[(0,s.jsx)(c.A,{className:"h-6 w-6 animate-spin mx-auto"})," Loading Payment Form..."]})});function U(){var e,t,a,_,E,U,q,B;let{user:S,userProfile:H}=(0,w.A)(),{toast:L}=(0,C.dj)(),O=(0,D.useRouter)(),z=(0,D.useSearchParams)(),F=(0,r.useRef)(null);(0,D.usePathname)();let[M,Y]=(0,r.useState)([]),[Z,K]=(0,r.useState)(null),[G,J]=(0,r.useState)([]),[V,$]=(0,r.useState)(""),[W,Q]=(0,r.useState)(!0),[X,ee]=(0,r.useState)(!1),[et,ea]=(0,r.useState)(!1),[es,er]=(0,r.useState)(!1),[ei,en]=(0,r.useState)(!1),[el,eo]=(0,r.useState)("idle"),[ed,ec]=(0,r.useState)(null),[em,eu]=(0,r.useState)(!1),[ep,ef]=(0,r.useState)("");(0,r.useEffect)(()=>{F.current&&F.current.scrollIntoView({behavior:"smooth"})},[G]),(0,r.useEffect)(()=>{if(!S)return Q(!1),Y([]),()=>{};Q(!0);let e=(0,k.rJ)(P.db,"customerRequests"),t=(0,k.P)(e,(0,k._M)("customerId","==",S.uid),(0,k.My)("updatedAt","desc")),a=(0,k.aQ)(t,async e=>{let t=e.docs.map(async e=>{var t;let a=e.data(),s=e=>{if(e){if(e instanceof k.Dc)return e.toDate();if("string"==typeof e||"number"==typeof e){let t=new Date(e);return isNaN(t.getTime())?void 0:t}if(e.seconds&&"number"==typeof e.seconds)return new k.Dc(e.seconds,e.nanoseconds).toDate()}},r={id:e.id,...a,eventDate:s(a.eventDate),createdAt:s(a.createdAt),updatedAt:s(a.updatedAt),activeProposal:a.activeProposal?{...a.activeProposal,proposedAt:s(a.activeProposal.proposedAt)}:null};if(null==(t=a.activeProposal)?void 0:t.chefId)try{let e=(0,k.H9)(P.db,"users",a.activeProposal.chefId),t=await (0,k.x7)(e);if(t.exists()){let e=t.data();r.proposingChef={name:e.name,profilePictureUrl:e.profilePictureUrl}}}catch(e){console.error("Error fetching proposing chef's profile:",e)}return r}),a=await Promise.all(t);Y(a);let s=z.get("requestId");if(s&&a.length>0){let e=a.find(e=>e.id===s);e&&(!Z||Z.id!==e.id)?ex(e):!e&&Z&&Z.id===s&&K(null)}else if(Z&&a.length>0){let e=a.find(e=>e.id===Z.id);e?K(t=>({...t,...e})):K(null)}Q(!1)},e=>{console.error("Error fetching customer requests:",e),L({title:"Error",description:"Could not fetch your requests.",variant:"destructive"}),Q(!1)});return()=>a()},[S,L,z]),(0,r.useEffect)(()=>{if(!Z)return J([]),()=>{};ee(!0);let e=(0,k.rJ)(P.db,"customerRequests",Z.id,"messages"),t=(0,k.P)(e,(0,k.My)("timestamp","asc")),a=(0,k.aQ)(t,e=>{J(e.docs.map(e=>{let t=e.data(),a=t.timestamp;if(a instanceof k.Dc)a=a.toDate();else if(a&&"function"==typeof a.toDate)a=a.toDate();else if(a&&"string"==typeof a){let e=new Date(a);a=isNaN(e.getTime())?new Date:e}else a&&"object"==typeof a&&void 0!==a.seconds?a=new k.Dc(a.seconds,a.nanoseconds).toDate():a instanceof Date||(console.warn("Unparseable timestamp in message, using current date as fallback:",t.timestamp),a=new Date);return{id:e.id,...t,timestamp:a}})),ee(!1)},e=>{console.error("Error fetching messages:",e),L({title:"Error",description:"Could not fetch messages for this request.",variant:"destructive"}),ee(!1)});return()=>a()},[Z,L]);let ex=e=>{K(e),$(""),eo("idle"),ec(null),z.get("requestId")!==e.id&&O.replace("/customer/dashboard/messages?requestId=".concat(e.id),{scroll:!1})},eh=async()=>{if(!S||!H||!Z||!V.trim())return;ea(!0);let e=(0,k.H9)(P.db,"customerRequests",Z.id);try{let t=(0,k.rJ)(e,"messages");await (0,k.gS)(t,{requestId:Z.id,senderId:S.uid,senderName:H.name||S.displayName||"Customer",senderAvatarUrl:H.profilePictureUrl||S.photoURL||void 0,senderRole:"customer",text:V,timestamp:(0,k.O5)()});let a=Z.status;("proposal_sent"===Z.status||"chef_accepted"===Z.status)&&(a="awaiting_customer_response"),await (0,k.mZ)(e,{updatedAt:(0,k.O5)(),status:a}),$("")}catch(e){console.error("Error sending message:",e),L({title:"Error",description:"Could not send message.",variant:"destructive"})}finally{ea(!1)}},eg=async e=>{en(!1),e.success&&e.paymentIntentId?(eo("awaiting_confirmation"),L({title:"Payment Processed!",description:"Finalizing your booking with the chef..."}),await ev(e.paymentIntentId)):(eo("failed"),ec(e.error||"Payment failed. Please try again or contact support."),L({title:"Payment Failed",description:e.error||"An unknown error occurred.",variant:"destructive"}))},ev=async e=>{if(!Z||!Z.activeProposal||!S||!H){eo("failed"),ec("Missing critical information to create booking."),L({title:"Booking Error",description:"Missing critical information.",variant:"destructive"});return}eu(!0);let t=(0,k.H9)(P.db,"customerRequests",Z.id),a="You accepted the proposal from Chef ".concat(Z.activeProposal.chefName,". Booking confirmed. Payment ID: ").concat(e.substring(0,10),"...");try{let s=(0,k.wP)(P.db),r=H.name||S.displayName||"Customer";s.update(t,{status:"booked",updatedAt:(0,k.O5)()});let i=Z.eventDate instanceof Date?k.Dc.fromDate(Z.eventDate):Z.eventDate,n=(0,k.H9)((0,k.rJ)(P.db,"bookings")),l={customerId:S.uid,customerName:r,chefId:Z.activeProposal.chefId,chefName:Z.activeProposal.chefName,chefAvatarUrl:Z.activeProposal.chefAvatarUrl||void 0,eventTitle:Z.activeProposal.menuTitle||Z.eventType||"Booked Event",eventDate:i,pax:Z.pax,totalPrice:Z.activeProposal.menuPricePerHead*Z.pax,pricePerHead:Z.activeProposal.menuPricePerHead,status:"confirmed",menuTitle:Z.activeProposal.menuTitle,location:Z.location||void 0,requestId:Z.id,paymentIntentId:e,createdAt:(0,k.O5)(),updatedAt:(0,k.O5)()};s.set(n,l);let o={chefId:l.chefId,date:l.eventDate,title:"Booking: ".concat(l.eventTitle),customerName:l.customerName,pax:l.pax,menuName:l.menuTitle||"Custom Event",pricePerHead:l.pricePerHead||0,location:l.location,notes:"Booking confirmed for request ID: ".concat(Z.id,". Booking ID: ").concat(n.id),status:"Confirmed",isWallEvent:!1},d=(0,k.H9)(P.db,"users/".concat(l.chefId,"/calendarEvents"),n.id);s.set(d,{...o,createdAt:(0,k.O5)(),updatedAt:(0,k.O5)()});let c=(0,k.rJ)(t,"messages"),m=(0,k.H9)(c);s.set(m,{requestId:Z.id,senderId:"system",senderRole:"system",text:a,timestamp:(0,k.O5)()}),await s.commit(),eo("confirmed"),L({title:"Booking Confirmed!",description:"Your event with Chef ".concat(l.chefName," is confirmed. Booking ID: ").concat(n.id.substring(0,6),"... Check 'My Booked Events'."),duration:7e3}),er(!1),O.push("/customer/dashboard/events")}catch(t){console.error("Error accepting proposal and creating booking:",t),eo("failed");let e=t instanceof Error?t.message:"Could not complete booking.";ec("Booking finalization failed. Details: ".concat(e)),L({title:"Booking Error",description:"Could not complete booking. Details: ".concat(e),variant:"destructive"})}finally{eu(!1)}},eN=async e=>{if(!Z||!Z.activeProposal||!S||!H)return;if(eo("idle"),ec(null),"accept"===e){er(!0),eo("payment_processing");return}eu(!0);let t=(0,k.H9)(P.db,"customerRequests",Z.id),a="You declined the proposal from Chef ".concat(Z.activeProposal.chefName,".");try{let e=(0,k.wP)(P.db);e.update(t,{status:"proposal_declined",activeProposal:null,updatedAt:(0,k.O5)()});let s=(0,k.rJ)(t,"messages"),r=(0,k.H9)(s);e.set(r,{requestId:Z.id,senderId:"system",senderRole:"system",text:a,timestamp:(0,k.O5)()}),await e.commit(),L({title:"Proposal Declined",variant:"default",description:"The chef has been notified."})}catch(t){console.error("Error declining proposal:",t);let e=t instanceof Error?t.message:"Could not decline proposal.";L({title:"Error",description:"Could not decline proposal. Details: ".concat(e),variant:"destructive"})}finally{eu(!1)}},eb=M.filter(e=>{var t,a;return e.eventType.toLowerCase().includes(ep.toLowerCase())||(null==(t=e.activeProposal)?void 0:t.chefName)&&e.activeProposal.chefName.toLowerCase().includes(ep.toLowerCase())||(null==(a=e.proposingChef)?void 0:a.name)&&e.proposingChef.name.toLowerCase().includes(ep.toLowerCase())}),ey=e=>e?e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()):"Unknown",ej=Z&&Z.activeProposal&&("proposal_sent"===Z.status||"chef_accepted"===Z.status),ew=Z&&("customer_confirmed"===Z.status||"booked"===Z.status||"proposal_declined"===Z.status||"cancelled_by_customer"===Z.status);return(0,s.jsxs)("div",{className:"h-[calc(100vh-var(--header-height,10rem))] flex flex-col md:flex-row gap-6",children:[(0,s.jsxs)(i.Zp,{className:"w-full md:w-1/3 lg:w-1/4 flex flex-col shadow-lg",children:[(0,s.jsxs)(i.aR,{className:"border-b p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(i.ZB,{className:"text-xl flex items-center",children:[(0,s.jsx)(m.A,{className:"mr-2 h-5 w-5 text-primary","data-ai-hint":"inbox mail"})," My Requests"]}),(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:eb.length})]}),(0,s.jsxs)("div",{className:"relative mt-2",children:[(0,s.jsx)(u.A,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),(0,s.jsx)(n.p,{placeholder:"Search by event or chef...",className:"pl-8",value:ep,onChange:e=>ef(e.target.value)})]})]}),(0,s.jsx)(i.Wu,{className:"p-0 flex-grow overflow-y-auto",children:W?(0,s.jsxs)("div",{className:"p-4 text-center text-muted-foreground flex items-center justify-center h-full",children:[(0,s.jsx)(c.A,{className:"h-5 w-5 animate-spin mr-2"})," Loading requests..."]}):eb.length>0?(0,s.jsx)("div",{className:"divide-y",children:eb.map(e=>{var t,a,r,i,n,l,o,c;return(0,s.jsx)("div",{className:"p-4 hover:bg-muted/50 cursor-pointer ".concat((null==Z?void 0:Z.id)===e.id?"bg-muted":""),onClick:()=>ex(e),children:(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsxs)(d.eu,{className:"h-10 w-10",children:[(0,s.jsx)(d.BK,{src:(null==(t=e.activeProposal)?void 0:t.chefAvatarUrl)||(null==(a=e.proposingChef)?void 0:a.profilePictureUrl)||void 0,alt:(null==(r=e.activeProposal)?void 0:r.chefName)||(null==(i=e.proposingChef)?void 0:i.name)||e.eventType.charAt(0),"data-ai-hint":"chef avatar"}),(0,s.jsx)(d.q5,{children:(null==(n=e.activeProposal)?void 0:n.chefName)?e.activeProposal.chefName.substring(0,1).toUpperCase():e.proposingChef?null==(l=e.proposingChef.name)?void 0:l.substring(0,1).toUpperCase():e.eventType.substring(0,1).toUpperCase()})]}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("p",{className:"text-sm font-semibold truncate",children:(null==(o=e.activeProposal)?void 0:o.chefName)?"Chef ".concat(e.activeProposal.chefName):(null==(c=e.proposingChef)?void 0:c.name)?"Chef ".concat(e.proposingChef.name):e.eventType}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:e.updatedAt?(0,A.GP)(new Date(e.updatedAt),"PP"):e.createdAt?(0,A.GP)(new Date(e.createdAt),"PP"):"N/A"})]}),(0,s.jsx)("p",{className:"text-xs font-medium text-primary",children:ey(e.status)}),(0,s.jsxs)("p",{className:"text-xs truncate text-muted-foreground",children:["Event: ",e.eventType]})]})]})},e.id)})}):(0,s.jsx)("p",{className:"p-4 text-center text-muted-foreground",children:"No requests found."})})]}),Z?(0,s.jsxs)(i.Zp,{className:"w-full md:w-2/3 lg:w-3/4 flex flex-col shadow-lg",children:[(0,s.jsxs)(i.aR,{className:"border-b p-4 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsxs)(d.eu,{className:"h-10 w-10",children:[(0,s.jsx)(d.BK,{src:(null==(e=Z.activeProposal)?void 0:e.chefAvatarUrl)||(null==(t=Z.proposingChef)?void 0:t.profilePictureUrl)||void 0,alt:(null==(a=Z.activeProposal)?void 0:a.chefName)||(null==(_=Z.proposingChef)?void 0:_.name)||Z.eventType.charAt(0),"data-ai-hint":"chef avatar"}),(0,s.jsx)(d.q5,{children:(null==(E=Z.activeProposal)?void 0:E.chefName)?Z.activeProposal.chefName.substring(0,1).toUpperCase():Z.proposingChef?null==(U=Z.proposingChef.name)?void 0:U.substring(0,1).toUpperCase():Z.eventType.substring(0,1).toUpperCase()})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(i.ZB,{className:"text-lg",children:(null==(q=Z.activeProposal)?void 0:q.chefName)?"Chat with Chef ".concat(Z.activeProposal.chefName):(null==(B=Z.proposingChef)?void 0:B.name)?"Chat with Chef ".concat(Z.proposingChef.name):Z.eventType}),(0,s.jsxs)(i.BT,{className:"text-xs",children:["Request ID: ",Z.id.substring(0,8),"... | Status: ",ey(Z.status)]})]})]}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground space-y-0.5 text-right self-start sm:self-center",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)(p.A,{className:"inline h-3 w-3 mr-1","data-ai-hint":"calendar icon"})," Event Date: ",Z.eventDate?(0,A.GP)(Z.eventDate,"PP"):"N/A"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)(Users,{className:"inline h-3 w-3 mr-1","data-ai-hint":"users group"})," PAX: ",Z.pax]}),(0,s.jsxs)("p",{children:[(0,s.jsx)(f.A,{className:"inline h-3 w-3 mr-1","data-ai-hint":"money dollar sign"})," Budget: $",Z.budget]})]})]}),(0,s.jsxs)(i.Wu,{className:"p-6 flex-grow overflow-y-auto space-y-4",children:[X?(0,s.jsxs)("div",{className:"flex justify-center items-center h-full",children:[(0,s.jsx)(c.A,{className:"h-5 w-5 animate-spin mr-2"}),"Loading messages..."]}):0!==G.length||Z.activeProposal||"idle"!==el||ew?(0,s.jsxs)(s.Fragment,{children:[G.map(e=>(0,s.jsx)("div",{className:"flex ".concat(e.senderId===(null==S?void 0:S.uid)?"justify-end":"justify-start"),children:(0,s.jsxs)("div",{className:"flex items-end gap-2 max-w-[75%]",children:[e.senderId!==(null==S?void 0:S.uid)&&"system"!==e.senderRole&&(0,s.jsxs)(d.eu,{className:"h-6 w-6",children:[(0,s.jsx)(d.BK,{src:e.senderAvatarUrl||void 0,alt:e.senderName||"U","data-ai-hint":"user avatar"}),(0,s.jsx)(d.q5,{children:e.senderName?e.senderName.charAt(0).toUpperCase():"chef"===e.senderRole?"C":"S"})]}),"system"===e.senderRole&&(0,s.jsx)(x.A,{className:"h-5 w-5 text-muted-foreground flex-shrink-0 self-center mr-1","data-ai-hint":"info icon"}),(0,s.jsxs)("div",{className:"px-3 py-2 rounded-xl shadow-sm ".concat(e.senderId===(null==S?void 0:S.uid)?"bg-primary text-primary-foreground":"system"===e.senderRole?"bg-amber-100 dark:bg-amber-800/30 text-amber-700 dark:text-amber-300 text-xs italic text-center w-full":"bg-muted"),children:[(0,s.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:e.text}),(0,s.jsx)("p",{className:"text-xs mt-1 ".concat(e.senderId===(null==S?void 0:S.uid)?"text-primary-foreground/70 text-right":"system"===e.senderRole?"hidden":"text-muted-foreground/70 text-left"),children:e.timestamp?(0,A.GP)(new Date(e.timestamp),"p"):"Sending..."})]}),e.senderId===(null==S?void 0:S.uid)&&H&&(0,s.jsxs)(d.eu,{className:"h-6 w-6",children:[(0,s.jsx)(d.BK,{src:H.profilePictureUrl||(null==S?void 0:S.photoURL)||void 0,alt:H.name||"Me","data-ai-hint":"user avatar"}),(0,s.jsx)(d.q5,{children:H.name?H.name.charAt(0).toUpperCase():"M"})]})]})},e.id)),(0,s.jsx)("div",{ref:F})]}):(0,s.jsx)("div",{className:"text-center text-muted-foreground py-8",children:"No messages yet. Await a chef's proposal or send a message if applicable."}),Z.activeProposal&&("proposal_sent"===Z.status||"chef_accepted"===Z.status)&&"idle"===el&&!ew&&(0,s.jsxs)(i.Zp,{className:"my-4 p-4 border shadow-md bg-sky-50 dark:bg-sky-800/30 border-sky-200 dark:border-sky-700",children:[(0,s.jsx)(i.aR,{className:"p-0 pb-2",children:(0,s.jsxs)(i.ZB,{className:"text-md flex items-center text-sky-700 dark:text-sky-300",children:[(0,s.jsx)(h.A,{className:"mr-2 h-5 w-5","data-ai-hint":"document file"}),"Proposal from Chef ",Z.activeProposal.chefName]})}),(0,s.jsxs)(i.Wu,{className:"p-0 text-sm space-y-1 text-sky-800 dark:text-sky-200",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)(g.A,{className:"inline h-4 w-4 mr-1 text-muted-foreground","data-ai-hint":"briefcase icon"}),"Menu: ",(0,s.jsx)("strong",{children:Z.activeProposal.menuTitle})]}),(0,s.jsxs)("p",{children:[(0,s.jsx)(f.A,{className:"inline h-4 w-4 mr-1 text-muted-foreground","data-ai-hint":"money dollar"}),"Price: ",(0,s.jsxs)("strong",{children:["$",Z.activeProposal.menuPricePerHead.toFixed(2)," per head"]})," (Total: $",(Z.activeProposal.menuPricePerHead*Z.pax).toFixed(2),")"]}),Z.activeProposal.notes&&(0,s.jsxs)("p",{children:[(0,s.jsx)(x.A,{className:"inline h-4 w-4 mr-1 text-muted-foreground","data-ai-hint":"info icon"}),"Notes: ",Z.activeProposal.notes]})]}),ej&&(0,s.jsxs)(i.wL,{className:"p-0 pt-3 flex gap-2",children:[(0,s.jsxs)(l.$,{onClick:()=>eN("accept"),size:"sm",className:"bg-green-600 hover:bg-green-700",disabled:"idle"!==el||em||ei,children:[(0,s.jsx)(v.A,{className:"h-4 w-4 mr-1.5","data-ai-hint":"check circle"})," Accept & Proceed to Pay"]}),(0,s.jsxs)(l.$,{onClick:()=>eN("decline"),size:"sm",variant:"outline",disabled:"idle"!==el||em||ei,children:[(0,s.jsx)(N.A,{className:"h-4 w-4 mr-1.5","data-ai-hint":"cross circle"})," Decline Proposal"]})]})]}),"customer_confirmed"===Z.status&&"confirmed"!==el&&"awaiting_confirmation"!==el&&(0,s.jsxs)("div",{className:"text-sm text-green-700 dark:text-green-400 mt-2 font-medium p-3 rounded-md bg-green-50 dark:bg-green-800/30 border border-green-200 dark:border-green-700 text-center",children:[(0,s.jsx)(v.A,{className:"inline h-5 w-5 mr-2","data-ai-hint":"check circle"})," You have accepted the proposal! Booking is being finalized."]}),"booked"===Z.status&&"confirmed"!==el&&(0,s.jsxs)("div",{className:"text-sm text-green-700 dark:text-green-400 mt-2 font-medium p-3 rounded-md bg-green-50 dark:bg-green-800/30 border border-green-200 dark:border-green-700 text-center",children:[(0,s.jsx)(v.A,{className:"inline h-5 w-5 mr-2","data-ai-hint":"check circle"})," This request has been booked. Check 'My Booked Events'."]}),"proposal_declined"===Z.status&&(0,s.jsxs)("div",{className:"text-sm text-red-700 dark:text-red-400 mt-2 font-medium p-3 rounded-md bg-red-50 dark:bg-red-800/30 border border-red-200 dark:border-red-700 text-center",children:[(0,s.jsx)(N.A,{className:"inline h-5 w-5 mr-2","data-ai-hint":"cross circle"})," You have declined this proposal."]}),"awaiting_confirmation"===el&&(0,s.jsxs)("div",{className:"text-sm text-blue-600 dark:text-blue-400 mt-2 font-medium p-3 rounded-md bg-blue-50 dark:bg-blue-800/30 border border-blue-200 dark:border-blue-700 text-center flex items-center justify-center",children:[(0,s.jsx)(c.A,{className:"animate-spin h-5 w-5 mr-2"})," Payment processed. Finalizing your booking, please wait..."]}),"confirmed"===el&&(0,s.jsxs)("div",{className:"text-sm text-green-700 dark:text-green-400 mt-2 font-medium p-3 rounded-md bg-green-50 dark:bg-green-800/30 border border-green-200 dark:border-green-700 text-center",children:[(0,s.jsx)(v.A,{className:"inline h-5 w-5 mr-2","data-ai-hint":"check circle"})," Booking confirmed! Check 'My Booked Events' for details."]}),"failed"===el&&ed&&(0,s.jsxs)("div",{className:"text-sm text-red-700 dark:text-red-400 mt-2 font-medium p-3 rounded-md bg-red-50 dark:bg-red-800/30 border border-red-200 dark:border-red-700 text-center",children:[(0,s.jsx)(b.A,{className:"inline h-5 w-5 mr-2","data-ai-hint":"warning triangle"})," ",ed]})]}),(0,s.jsxs)(i.wL,{className:"p-4 border-t flex flex-col space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center text-xs text-muted-foreground p-2 rounded-md bg-muted/50 border border-dashed w-full",children:[(0,s.jsx)(b.A,{className:"h-4 w-4 mr-2 text-yellow-600 flex-shrink-0","data-ai-hint":"warning triangle"}),(0,s.jsx)("span",{children:"Remember: Keep all communication and payment on FindAChef. Do not share personal contact details."})]}),(0,s.jsxs)("div",{className:"flex w-full items-center space-x-2",children:[(0,s.jsx)(o.T,{placeholder:ew||"idle"!==el||em||ei?"Conversation ended or action pending.":"Type your message...",value:V,onChange:e=>$(e.target.value),className:"flex-1 min-h-[40px] max-h-[120px]",rows:1,disabled:et||ew||"idle"!==el||em||ei,onKeyDown:e=>{"Enter"===e.key&&!e.shiftKey&&(e.preventDefault(),!V.trim()||ew||"idle"!==el||em||ei||eh())}}),(0,s.jsxs)(l.$,{type:"button",size:"icon",onClick:eh,disabled:et||!V.trim()||ew||"idle"!==el||em||ei,children:[et?(0,s.jsx)(c.A,{className:"animate-spin h-5 w-5"}):(0,s.jsx)(y.A,{className:"h-5 w-5"}),(0,s.jsx)("span",{className:"sr-only",children:"Send"})]})]})]})]}):(0,s.jsxs)("div",{className:"w-full md:w-2/3 lg:w-3/4 flex flex-col items-center justify-center text-center p-10 bg-muted/30 rounded-lg shadow-lg",children:[(0,s.jsx)(m.A,{className:"h-16 w-16 text-muted-foreground mb-4","data-ai-hint":"empty inbox messages"}),(0,s.jsx)("p",{className:"text-lg font-semibold text-muted-foreground",children:"Select a request from the left to view messages and details."}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Your conversations with chefs will appear here."})]}),Z&&Z.activeProposal&&(0,s.jsx)(I.AlertDialog,{open:es,onOpenChange:e=>{(ei||em)&&e||("awaiting_confirmation"!==el||ei||e||eo("idle"),er(e))},children:(0,s.jsxs)(I.AlertDialogContent,{children:[(0,s.jsxs)(I.AlertDialogHeader,{children:[(0,s.jsxs)(I.AlertDialogTitle,{className:"flex items-center",children:[(0,s.jsx)(j.A,{className:"mr-2 h-5 w-5 text-primary","data-ai-hint":"credit card"}),"Confirm Booking & Payment"]}),(0,s.jsxs)(I.AlertDialogDescription,{className:"text-left space-y-2 pt-2",children:[(0,s.jsxs)("p",{children:["You are about to accept the proposal from ",(0,s.jsxs)("strong",{children:["Chef ",Z.activeProposal.chefName]})," for: ",(0,s.jsxs)("strong",{children:['"',Z.activeProposal.menuTitle||Z.eventType,'"']}),"."]}),(0,s.jsxs)("p",{children:["Total Price: ",(0,s.jsxs)("strong",{className:"text-lg",children:["AUD ",(Z.activeProposal.menuPricePerHead*Z.pax).toFixed(2)]}),"."]}),"payment_processing"===el&&!ei&&!em&&(0,s.jsxs)("div",{className:"text-sm text-blue-600 flex items-center justify-center py-2",children:[(0,s.jsx)(c.A,{className:"h-4 w-4 animate-spin mr-2"})," Verifying payment details..."]}),(em||"awaiting_confirmation"===el)&&!ed&&(0,s.jsxs)("div",{className:"text-sm text-blue-600 flex items-center justify-center py-2",children:[(0,s.jsx)(c.A,{className:"h-4 w-4 animate-spin mr-2"})," Finalizing your booking, please wait..."]}),ed&&"failed"===el&&(0,s.jsxs)("div",{className:"text-sm text-destructive flex items-center justify-center py-2",children:[(0,s.jsx)(b.A,{className:"h-4 w-4 mr-2"})," ",ed]})]})]}),"payment_processing"===el&&(0,s.jsx)(R,{children:(0,s.jsx)(T,{customerName:(null==H?void 0:H.name)||(null==S?void 0:S.displayName)||"Customer",customerEmail:(null==S?void 0:S.email)||"",totalPrice:Z.activeProposal.menuPricePerHead*Z.pax,onPaymentAttemptComplete:eg,isProcessingPayment:ei,setIsProcessingPayment:en,requestId:Z.id,customerId:(null==S?void 0:S.uid)||""})}),(0,s.jsx)(I.AlertDialogFooter,{className:"mt-2",children:(0,s.jsx)(I.AlertDialogCancel,{onClick:()=>{er(!1),eo("idle"),ec(null),en(!1),eu(!1)},disabled:ei||em||"awaiting_confirmation"===el,children:"Cancel"})})]})})]})}},62523:(e,t,a)=>{"use strict";a.d(t,{p:()=>n});var s=a(95155),r=a(12115),i=a(59434);let n=r.forwardRef((e,t)=>{let{className:a,type:r,...n}=e;return(0,s.jsx)("input",{type:r,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...n})});n.displayName="Input"},88539:(e,t,a)=>{"use strict";a.d(t,{T:()=>n});var s=a(95155),r=a(12115),i=a(59434);let n=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...r})});n.displayName="Textarea"},90010:(e,t,a)=>{"use strict";a.r(t),a.d(t,{AlertDialog:()=>o,AlertDialogAction:()=>g,AlertDialogCancel:()=>v,AlertDialogContent:()=>u,AlertDialogDescription:()=>h,AlertDialogFooter:()=>f,AlertDialogHeader:()=>p,AlertDialogOverlay:()=>m,AlertDialogPortal:()=>c,AlertDialogTitle:()=>x,AlertDialogTrigger:()=>d});var s=a(95155),r=a(12115),i=a(17649),n=a(59434),l=a(30285);let o=i.bL,d=i.l9,c=i.ZL,m=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(i.hJ,{className:(0,n.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r,ref:t})});m.displayName=i.hJ.displayName;let u=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsxs)(c,{children:[(0,s.jsx)(m,{}),(0,s.jsx)(i.UC,{ref:t,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...r})]})});u.displayName=i.UC.displayName;let p=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...a})};p.displayName="AlertDialogHeader";let f=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};f.displayName="AlertDialogFooter";let x=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(i.hE,{ref:t,className:(0,n.cn)("text-lg font-semibold",a),...r})});x.displayName=i.hE.displayName;let h=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(i.VY,{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...r})});h.displayName=i.VY.displayName;let g=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(i.rc,{ref:t,className:(0,n.cn)((0,l.r)(),a),...r})});g.displayName=i.rc.displayName;let v=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(i.ZD,{ref:t,className:(0,n.cn)((0,l.r)({variant:"outline"}),"mt-2 sm:mt-0",a),...r})});v.displayName=i.ZD.displayName},91394:(e,t,a)=>{"use strict";a.d(t,{BK:()=>o,eu:()=>l,q5:()=>d});var s=a(95155),r=a(12115),i=a(85977),n=a(59434);let l=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(i.bL,{ref:t,className:(0,n.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...r})});l.displayName=i.bL.displayName;let o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(i._V,{ref:t,className:(0,n.cn)("aspect-square h-full w-full",a),...r})});o.displayName=i._V.displayName;let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(i.H4,{ref:t,className:(0,n.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...r})});d.displayName=i.H4.displayName}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,7446,9352,5100,4602,1345,3067,5388,7649,9331,8226,8441,1684,7358],()=>t(7824)),_N_E=e.O()}]);