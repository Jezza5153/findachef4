(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1904],{26126:(e,t,a)=>{"use strict";a.d(t,{E:()=>i});var s=a(95155);a(12115);var r=a(74466),n=a(59434);let l=(0,r.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:a,...r}=e;return(0,s.jsx)("div",{className:(0,n.cn)(l({variant:a}),t),...r})}},32730:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>z});var s=a(95155),r=a(12115),n=a(66695),l=a(26126),i=a(55365),o=a(30285),d=a(59576),c=a(56104),m=a(35317),u=a(85388),h=a(51154),x=a(44008),f=a(50744),p=a(17580),v=a(4516),g=a(55868),b=a(97939),j=a(81284),N=a(81497),y=a(54861),w=a(57434),A=a(66766),k=a(6874),D=a.n(k),C=a(35695),P=a(87481),B=a(31857),T=a(55028);let E=(0,T.default)(()=>Promise.all([a.e(1345),a.e(5620)]).then(a.bind(a,65620)).then(e=>e.BookingInvoiceDialog),{loadableGenerated:{webpack:()=>[65620]},ssr:!1,loading:()=>(0,s.jsxs)("div",{className:"p-4 text-center",children:[(0,s.jsx)(h.A,{className:"h-6 w-6 animate-spin inline-block"})," Loading invoice viewer..."]})}),_=(0,T.default)(()=>Promise.all([a.e(1345),a.e(7649),a.e(816)]).then(a.bind(a,90010)).then(e=>e.AlertDialog),{loadableGenerated:{webpack:()=>[90010]},ssr:!1}),S=(0,T.default)(()=>Promise.all([a.e(1345),a.e(7649),a.e(816)]).then(a.bind(a,90010)).then(e=>e.AlertDialogAction),{loadableGenerated:{webpack:()=>[90010]},ssr:!1}),q=(0,T.default)(()=>Promise.all([a.e(1345),a.e(7649),a.e(816)]).then(a.bind(a,90010)).then(e=>e.AlertDialogCancel),{loadableGenerated:{webpack:()=>[90010]},ssr:!1}),G=(0,T.default)(()=>Promise.all([a.e(1345),a.e(7649),a.e(816)]).then(a.bind(a,90010)).then(e=>e.AlertDialogContent),{loadableGenerated:{webpack:()=>[90010]},ssr:!1}),I=(0,T.default)(()=>Promise.all([a.e(1345),a.e(7649),a.e(816)]).then(a.bind(a,90010)).then(e=>e.AlertDialogDescription),{loadableGenerated:{webpack:()=>[90010]},ssr:!1}),L=(0,T.default)(()=>Promise.all([a.e(1345),a.e(7649),a.e(816)]).then(a.bind(a,90010)).then(e=>e.AlertDialogFooter),{loadableGenerated:{webpack:()=>[90010]},ssr:!1}),M=(0,T.default)(()=>Promise.all([a.e(1345),a.e(7649),a.e(816)]).then(a.bind(a,90010)).then(e=>e.AlertDialogHeader),{loadableGenerated:{webpack:()=>[90010]},ssr:!1}),R=(0,T.default)(()=>Promise.all([a.e(1345),a.e(7649),a.e(816)]).then(a.bind(a,90010)).then(e=>e.AlertDialogTitle),{loadableGenerated:{webpack:()=>[90010]},ssr:!1}),F=(0,T.default)(()=>Promise.all([a.e(1345),a.e(7649),a.e(816)]).then(a.bind(a,90010)).then(e=>e.AlertDialogTrigger),{loadableGenerated:{webpack:()=>[90010]},ssr:!1});function z(){let{user:e,userProfile:t}=(0,d.A)(),a=(0,C.useRouter)(),{toast:k}=(0,P.dj)(),[T,z]=(0,r.useState)([]),[O,$]=(0,r.useState)(!0),[Z,V]=(0,r.useState)(null),[Y,Q]=(0,r.useState)(!1),[U,W]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(!e){$(!1),z([]);return}$(!0);let t=(0,m.rJ)(c.db,"bookings"),a=(0,m.P)(t,(0,m._M)("customerId","==",e.uid),(0,m.My)("eventDate","desc")),s=(0,m.aQ)(a,e=>{z(e.docs.map(e=>{let t=e.data();return{id:e.id,...t,eventDate:t.eventDate instanceof m.Dc?t.eventDate.toDate():new Date(t.eventDate),createdAt:t.createdAt instanceof m.Dc?t.createdAt.toDate():t.createdAt?new Date(t.createdAt):void 0,updatedAt:t.updatedAt instanceof m.Dc?t.updatedAt.toDate():t.updatedAt?new Date(t.updatedAt):void 0,qrCodeScannedAt:t.qrCodeScannedAt instanceof m.Dc?t.qrCodeScannedAt.toDate():t.qrCodeScannedAt?new Date(t.qrCodeScannedAt):void 0}})),$(!1)},e=>{console.error("Error fetching booked events:",e),k({title:"Error Loading Bookings",description:"Could not fetch your booked events.",variant:"destructive"}),z([]),$(!1)});return()=>s()},[e,k]);let X=e=>{if(!e)return"outline";switch(e){case"confirmed":return"default";case"completed":return"secondary";case"cancelled_by_customer":case"cancelled_by_chef":case"payment_failed":return"destructive";default:return"outline"}},H=async t=>{if(!e)return;let a=T.find(e=>e.id===t);if(!a)return void k({title:"Error",description:"Booking not found.",variant:"destructive"});if("confirmed"!==a.status)return void k({title:"Cancellation Not Allowed",description:"This booking cannot be cancelled at its current stage.",variant:"destructive"});V(t);try{let e=(0,m.H9)(c.db,"bookings",t);await (0,m.mZ)(e,{status:"cancelled_by_customer",updatedAt:(0,m.O5)()}),k({title:"Booking Cancelled",description:'Your booking for "'.concat(a.eventTitle,'" has been cancelled.')})}catch(e){console.error("Error cancelling booking:",e),k({title:"Error",description:"Could not cancel booking. Please try again.",variant:"destructive"})}finally{V(null)}},J=e=>{W(e),Q(!0)},K=e=>{e.requestId?a.push("/customer/dashboard/messages?requestId=".concat(e.requestId)):k({title:"Messaging Not Available",description:"Direct messaging for this event type is not yet fully integrated.",variant:"default"})},ee=e=>"confirmed"===e;return O?(0,s.jsxs)("div",{className:"flex justify-center items-center h-64",children:[(0,s.jsx)(h.A,{className:"h-8 w-8 animate-spin text-primary","data-ai-hint":"loading spinner"}),(0,s.jsx)("p",{className:"ml-2",children:"Loading your booked events..."})]}):(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsx)("div",{className:"flex justify-between items-center",children:(0,s.jsxs)("h1",{className:"text-3xl font-bold flex items-center",children:[(0,s.jsx)(x.A,{className:"mr-3 h-8 w-8 text-primary","data-ai-hint":"calendar check"})," My Booked Events"]})}),0===T.length?(0,s.jsxs)(n.Zp,{className:"text-center py-12 border-dashed",children:[(0,s.jsxs)(n.aR,{children:[(0,s.jsx)(x.A,{className:"mx-auto h-12 w-12 text-muted-foreground mb-3","data-ai-hint":"calendar empty"}),(0,s.jsx)(n.ZB,{children:"No Booked Events Yet"})]}),(0,s.jsxs)(n.Wu,{children:[(0,s.jsx)("p",{className:"text-muted-foreground mb-4",children:"You haven't booked any events. Time to explore!"}),(0,s.jsxs)("div",{className:"space-x-2",children:[(0,s.jsx)(o.$,{asChild:!0,children:(0,s.jsx)(D(),{href:"/customer/menus",children:"Browse Chef Menus"})}),(0,s.jsx)(o.$,{variant:"outline",asChild:!0,children:(0,s.jsx)(D(),{href:"/customer/wall",children:"Discover Chef Events"})})]})]})]}):(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:T.map(e=>{var t;return(0,s.jsxs)(n.Zp,{className:"shadow-lg",children:[(0,s.jsxs)(n.aR,{children:[(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsx)(n.ZB,{className:"text-xl",children:e.eventTitle}),(0,s.jsx)(l.E,{variant:X(e.status),className:"capitalize",children:(null==(t=e.status)?void 0:t.replace(/_/g," "))||"Unknown"})]}),e.chefName&&(0,s.jsxs)(n.BT,{className:"flex items-center text-sm",children:[e.chefAvatarUrl?(0,s.jsx)(A.default,{src:e.chefAvatarUrl,alt:e.chefName,width:24,height:24,className:"rounded-full mr-2 object-cover","data-ai-hint":"chef portrait"}):(0,s.jsx)(f.A,{className:"h-4 w-4 mr-2 text-muted-foreground","data-ai-hint":"chef hat"}),"With Chef ",e.chefName]}),e.menuTitle&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Menu: ",e.menuTitle]})]}),(0,s.jsxs)(n.Wu,{className:"space-y-3 text-sm",children:[(0,s.jsxs)("div",{className:"flex items-center text-muted-foreground",children:[(0,s.jsx)(x.A,{className:"h-4 w-4 mr-2 text-primary","data-ai-hint":"calendar event"}),"Date: ",(0,s.jsx)("span",{className:"font-medium text-foreground ml-1",children:e.eventDate?(0,u.GP)(new Date(e.eventDate),"PPpp"):"Date TBD"})]}),(0,s.jsxs)("div",{className:"flex items-center text-muted-foreground",children:[(0,s.jsx)(p.A,{className:"h-4 w-4 mr-2 text-primary","data-ai-hint":"people group"}),"Guests: ",(0,s.jsx)("span",{className:"font-medium text-foreground ml-1",children:e.pax})]}),e.location&&(0,s.jsxs)("div",{className:"flex items-center text-muted-foreground",children:[(0,s.jsx)(v.A,{className:"h-4 w-4 mr-2 text-primary","data-ai-hint":"location map"}),"Location: ",(0,s.jsx)("span",{className:"font-medium text-foreground ml-1",children:e.location})]}),(0,s.jsxs)("div",{className:"flex items-center text-muted-foreground",children:[(0,s.jsx)(g.A,{className:"h-4 w-4 mr-2 text-green-600","data-ai-hint":"money dollar"}),"Total Price: ",(0,s.jsxs)("span",{className:"font-medium text-foreground ml-1",children:["$",e.totalPrice.toFixed(2)]})]}),"confirmed"===e.status&&!e.qrCodeScannedAt&&e.id&&(0,s.jsxs)(i.Fc,{variant:"default",className:"mt-4 bg-blue-500/10 border-blue-500/30",children:[(0,s.jsx)(b.A,{className:"h-5 w-5 text-blue-600","data-ai-hint":"qr code"}),(0,s.jsx)(i.XL,{className:"text-blue-700 font-semibold",children:"Event Completion QR Code"}),I&&(0,s.jsxs)(I,{className:"text-blue-600 text-xs space-y-1",children:[(0,s.jsx)("p",{children:"On the day of your event, show this QR code area and the Booking ID below to your chef. They will scan it or enter the ID to confirm completion."}),(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-2 bg-white rounded-md my-2 shadow",children:[(0,s.jsx)(B.h,{value:e.id,size:120,bgColor:"#ffffff",fgColor:"#000000",level:"L"}),(0,s.jsxs)("p",{className:"text-xs font-mono mt-1.5 text-black",children:["Booking ID: ",(0,s.jsx)("span",{className:"font-bold",children:e.id})]})]})]})]}),"completed"===e.status&&e.qrCodeScannedAt&&(0,s.jsxs)("p",{className:"text-xs text-green-700 flex items-center",children:[(0,s.jsx)(j.A,{className:"h-3 w-3 mr-1","data-ai-hint":"information circle"}),"Event marked complete on ",(0,u.GP)(new Date(e.qrCodeScannedAt),"PP"),"."]})]}),(0,s.jsxs)(n.wL,{className:"flex flex-col sm:flex-row justify-between items-center pt-4 border-t space-y-2 sm:space-y-0 sm:gap-2",children:[(0,s.jsxs)(o.$,{variant:"outline",size:"sm",onClick:()=>K(e),className:"w-full sm:w-auto",children:[(0,s.jsx)(N.A,{className:"mr-2 h-4 w-4"})," Message Chef"]}),(0,s.jsxs)("div",{className:"flex space-x-2 w-full sm:w-auto",children:[ee(e.status)&&_&&F&&(0,s.jsxs)(_,{children:[(0,s.jsx)(F,{asChild:!0,children:(0,s.jsxs)(o.$,{variant:"destructive",size:"sm",disabled:Z===e.id,className:"flex-1 sm:flex-none",children:[Z===e.id?(0,s.jsx)(h.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(y.A,{className:"mr-2 h-4 w-4"}),"Cancel Booking"]})}),(0,s.jsxs)(G,{children:[(0,s.jsxs)(M,{children:[(0,s.jsx)(R,{children:"Are you absolutely sure?"}),I&&(0,s.jsxs)(I,{children:['Are you sure you want to cancel this booking for "',e.eventTitle,'"? Please review our cancellation policy in the Terms of Service.']})]}),(0,s.jsxs)(L,{children:[(0,s.jsx)(q,{children:"Keep Booking"}),(0,s.jsx)(S,{onClick:()=>H(e.id),className:"bg-destructive hover:bg-destructive/90",children:"Yes, Cancel Booking"})]})]})]}),("completed"===e.status||"confirmed"===e.status)&&(0,s.jsxs)(o.$,{variant:"link",size:"sm",className:"p-0 h-auto text-xs flex-1 sm:flex-none justify-center",onClick:()=>J(e),children:[(0,s.jsx)(w.A,{className:"mr-1 h-4 w-4"})," View Confirmation / Invoice"]})]})]})]},e.id)})}),(0,s.jsxs)(i.Fc,{className:"mt-8",children:[(0,s.jsx)(j.A,{className:"h-4 w-4","data-ai-hint":"information circle"}),(0,s.jsx)(i.XL,{children:"Booking Information"}),I&&(0,s.jsxs)(I,{className:"text-xs",children:["This page shows your confirmed and past events. If you've just made a request or a chef has sent a proposal, check your ",(0,s.jsx)(D(),{href:"/customer/dashboard/messages",className:"underline hover:text-primary",children:"Messages"})," for updates. Bookings are finalized after payment and mutual confirmation. Cancellation policies apply as per our ",(0,s.jsx)(D(),{href:"/terms",className:"underline hover:text-primary",children:"Terms of Service"}),"."]})]}),Y&&U&&E&&(0,s.jsx)(E,{isOpen:Y,onOpenChange:Q,booking:U,customerName:(null==t?void 0:t.name)||(null==e?void 0:e.displayName)||"Valued Customer"})]})}},55365:(e,t,a)=>{"use strict";a.d(t,{Fc:()=>o,TN:()=>c,XL:()=>d});var s=a(95155),r=a(12115),n=a(74466),l=a(59434);let i=(0,n.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),o=r.forwardRef((e,t)=>{let{className:a,variant:r,...n}=e;return(0,s.jsx)("div",{ref:t,role:"alert",className:(0,l.cn)(i({variant:r}),a),...n})});o.displayName="Alert";let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("h5",{ref:t,className:(0,l.cn)("mb-1 font-medium leading-none tracking-tight",a),...r})});d.displayName="AlertTitle";let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("text-sm [&_p]:leading-relaxed",a),...r})});c.displayName="AlertDescription"},97715:(e,t,a)=>{Promise.resolve().then(a.bind(a,32730))}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,7446,9352,5100,4602,6874,6766,106,5388,6086,8226,8441,1684,7358],()=>t(97715)),_N_E=e.O()}]);