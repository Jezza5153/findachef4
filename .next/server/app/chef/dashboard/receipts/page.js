(()=>{var e={};e.id=3128,e.ids=[3128],e.modules={643:e=>{"use strict";e.exports=require("node:perf_hooks")},954:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d});var r=s(65239),a=s(48088),i=s(88170),n=s.n(i),l=s(30893),o={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let d={children:["",{children:["chef",{children:["dashboard",{children:["receipts",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,93993)),"/home/user/studio/src/app/chef/dashboard/receipts/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,16963)),"/home/user/studio/src/app/chef/dashboard/layout.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,32416)),"/home/user/studio/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["/home/user/studio/src/app/chef/dashboard/receipts/page.tsx"],u={require:s,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/chef/dashboard/receipts/page",pathname:"/chef/dashboard/receipts",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},1708:e=>{"use strict";e.exports=require("node:process")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4573:e=>{"use strict";e.exports=require("node:buffer")},6211:(e,t,s)=>{"use strict";s.d(t,{A0:()=>l,BF:()=>o,Hj:()=>d,XI:()=>n,nA:()=>u,nd:()=>c});var r=s(60687),a=s(43210),i=s(4780);let n=a.forwardRef(({className:e,...t},s)=>(0,r.jsx)("div",{className:"relative w-full overflow-auto",children:(0,r.jsx)("table",{ref:s,className:(0,i.cn)("w-full caption-bottom text-sm",e),...t})}));n.displayName="Table";let l=a.forwardRef(({className:e,...t},s)=>(0,r.jsx)("thead",{ref:s,className:(0,i.cn)("[&_tr]:border-b",e),...t}));l.displayName="TableHeader";let o=a.forwardRef(({className:e,...t},s)=>(0,r.jsx)("tbody",{ref:s,className:(0,i.cn)("[&_tr:last-child]:border-0",e),...t}));o.displayName="TableBody",a.forwardRef(({className:e,...t},s)=>(0,r.jsx)("tfoot",{ref:s,className:(0,i.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t})).displayName="TableFooter";let d=a.forwardRef(({className:e,...t},s)=>(0,r.jsx)("tr",{ref:s,className:(0,i.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));d.displayName="TableRow";let c=a.forwardRef(({className:e,...t},s)=>(0,r.jsx)("th",{ref:s,className:(0,i.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));c.displayName="TableHead";let u=a.forwardRef(({className:e,...t},s)=>(0,r.jsx)("td",{ref:s,className:(0,i.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));u.displayName="TableCell",a.forwardRef(({className:e,...t},s)=>(0,r.jsx)("caption",{ref:s,className:(0,i.cn)("mt-4 text-sm text-muted-foreground",e),...t})).displayName="TableCaption"},7252:e=>{"use strict";e.exports=require("express")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12412:e=>{"use strict";e.exports=require("assert")},15079:(e,t,s)=>{"use strict";s.d(t,{bq:()=>p,eb:()=>f,gC:()=>x,l6:()=>c,yv:()=>u});var r=s(60687),a=s(43210),i=s(24182),n=s(61662),l=s(89743),o=s(58450),d=s(4780);let c=i.bL;i.YJ;let u=i.WT,p=a.forwardRef(({className:e,children:t,...s},a)=>(0,r.jsxs)(i.l9,{ref:a,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...s,children:[t,(0,r.jsx)(i.In,{asChild:!0,children:(0,r.jsx)(n.A,{className:"h-4 w-4 opacity-50"})})]}));p.displayName=i.l9.displayName;let m=a.forwardRef(({className:e,...t},s)=>(0,r.jsx)(i.PP,{ref:s,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",e),...t,children:(0,r.jsx)(l.A,{className:"h-4 w-4"})}));m.displayName=i.PP.displayName;let h=a.forwardRef(({className:e,...t},s)=>(0,r.jsx)(i.wn,{ref:s,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",e),...t,children:(0,r.jsx)(n.A,{className:"h-4 w-4"})}));h.displayName=i.wn.displayName;let x=a.forwardRef(({className:e,children:t,position:s="popper",...a},n)=>(0,r.jsx)(i.ZL,{children:(0,r.jsxs)(i.UC,{ref:n,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:s,...a,children:[(0,r.jsx)(m,{}),(0,r.jsx)(i.LM,{className:(0,d.cn)("p-1","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),(0,r.jsx)(h,{})]})}));x.displayName=i.UC.displayName,a.forwardRef(({className:e,...t},s)=>(0,r.jsx)(i.JU,{ref:s,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t})).displayName=i.JU.displayName;let f=a.forwardRef(({className:e,children:t,...s},a)=>(0,r.jsxs)(i.q7,{ref:a,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...s,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(i.VF,{children:(0,r.jsx)(o.A,{className:"h-4 w-4"})})}),(0,r.jsx)(i.p4,{children:t})]}));f.displayName=i.q7.displayName,a.forwardRef(({className:e,...t},s)=>(0,r.jsx)(i.wv,{ref:s,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",e),...t})).displayName=i.wv.displayName},16141:e=>{"use strict";e.exports=require("node:zlib")},16698:e=>{"use strict";e.exports=require("node:async_hooks")},16963:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/user/studio/src/app/chef/dashboard/layout.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/user/studio/src/app/chef/dashboard/layout.tsx","default")},19063:e=>{"use strict";e.exports=require("require-in-the-middle")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},19185:e=>{"use strict";e.exports=require("dgram")},19771:e=>{"use strict";e.exports=require("process")},20620:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(82614).A)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},21820:e=>{"use strict";e.exports=require("os")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30769:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>C});var r=s(60687);s(43210);var a=s(16189),i=s(59059),n=s(44802),l=s(18329),o=s(92876),d=s(86447),c=s(71757),u=s(52831),p=s(28399),m=s(15343),h=s(36644),x=s(69678),f=s(29867),g=s(18780),j=s(44493),v=s(29523),y=s(33784),b=s(24052),w=s(11516);let N=(0,s(30036).default)(async()=>{},{loadableGenerated:{modules:["app/chef/dashboard/layout.tsx -> @/components/dashboard-layout"]},ssr:!1,loading:()=>(0,r.jsxs)("div",{className:"flex h-screen items-center justify-center",children:[(0,r.jsx)(w.A,{className:"h-12 w-12 animate-spin text-primary"})," Loading Dashboard..."]})}),A=[{href:"/chef/dashboard",label:"Overview",icon:(0,r.jsx)(i.A,{}),matchExact:!0},{href:"/chef/dashboard/profile",label:"My Profile",icon:(0,r.jsx)(n.A,{})},{href:"/chef/dashboard/requests",label:"Requests",icon:(0,r.jsx)(l.A,{})},{href:"/chef/dashboard/calendar",label:"Calendar & Events",icon:(0,r.jsx)(o.A,{})},{href:"/chef/dashboard/wall",label:"The Chef's Wall",icon:(0,r.jsx)(d.A,{})},{href:"/chef/dashboard/menus",label:"Menus",icon:(0,r.jsx)(c.A,{})},{href:"/chef/dashboard/shopping-list",label:"Shopping List",icon:(0,r.jsx)(u.A,{})},{href:"/chef/dashboard/chefs",label:"Chef Directory",icon:(0,r.jsx)(p.A,{})},{href:"/chef/dashboard/collaborations",label:"Collaborations",icon:(0,r.jsx)(m.A,{})},{href:"/chef/dashboard/receipts",label:"Receipts & Costs",icon:(0,r.jsx)(h.A,{})}];function C({children:e}){let t=(0,a.useRouter)(),{toast:s}=(0,f.dj)(),{user:i,userProfile:n,loading:l,isChef:o,isChefApproved:d,profileLoading:c}=(0,g.A)();return l||c?(0,r.jsxs)("div",{className:"flex h-screen items-center justify-center bg-background",children:[(0,r.jsx)(w.A,{className:"h-12 w-12 animate-spin text-primary","data-ai-hint":"loading spinner"}),(0,r.jsx)("p",{className:"ml-3 text-lg text-foreground",children:"Loading Chef Dashboard..."})]}):i&&o?d||n&&"admin"===n.role?(0,r.jsx)(N,{navItems:A,children:e}):(0,r.jsx)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-background p-4",children:(0,r.jsxs)(j.Zp,{className:"w-full max-w-md text-center shadow-lg",children:[(0,r.jsxs)(j.aR,{children:[(0,r.jsx)("div",{className:"mx-auto mb-4 inline-flex h-16 w-16 items-center justify-center rounded-full bg-yellow-500/10 text-yellow-600",children:(0,r.jsx)(x.A,{className:"h-8 w-8","data-ai-hint":"security shield alert"})}),(0,r.jsx)(j.ZB,{className:"text-2xl",children:"Account Pending Approval"})]}),(0,r.jsxs)(j.Wu,{className:"space-y-4",children:[(0,r.jsx)("p",{className:"text-muted-foreground",children:"Thank you for signing up! Your chef profile is currently under review by our team. You will be notified once your account is approved. This can take up to 48 hours."}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"If you have any questions, please contact support."}),(0,r.jsx)(v.$,{onClick:async()=>{try{await (0,b.CI)(y.j2),s({title:"Logged Out",description:"You have been logged out."})}catch(e){console.error("Error signing out:",e),s({title:"Logout Error",description:`Could not log out: ${e.message}`,variant:"destructive"})}t.push("/login")},children:"Back to Login"})]})]})}):(0,r.jsxs)("div",{className:"flex h-screen items-center justify-center bg-background",children:[(0,r.jsx)(w.A,{className:"h-12 w-12 animate-spin text-primary"}),(0,r.jsx)("p",{className:"ml-3 text-lg text-foreground",children:"Verifying chef access..."})]})}},33559:(e,t,s)=>{"use strict";s.r(t),s.d(t,{"40927f8807ec76451e0441317d257c24c9ce49bc73":()=>x,"40dc12ff6aade17c2b480cff9632b0364b2480bd8f":()=>c});var r=s(91199);s(42087);var a=s(95427),i=s(37612),n=s(33331);let l=["Ingredient","Equipment","Tax","BAS","Travel","Other"],o=i.z.object({receiptImageUri:i.z.string().describe("A receipt image as a data URI that must include a MIME type and use Base64 encoding. Expected format: 'data:<mimetype>;base64,<encoded_data>'.")}),d=i.z.object({vendor:i.z.string().optional().describe("The vendor name extracted from the receipt."),date:i.z.string().optional().describe("The transaction date (YYYY-MM-DD) from the receipt."),totalAmount:i.z.number().optional().describe("The total amount from the receipt."),suggestedCostType:i.z.enum(l).optional().describe(`The suggested cost category for this receipt (e.g., ${l.join(", ")}).`)});async function c(e){return p(e)}let u=a.ai.definePrompt({name:"receiptParserPrompt",input:{schema:o},output:{schema:d},prompt:`You are an expert receipt analysis AI. Analyze the provided receipt image.
Extract the following information:
1.  Vendor Name (e.g., "SuperMart", "Kitchen Supplies Co.")
2.  Transaction Date (format as YYYY-MM-DD)
3.  Total Amount (as a number, e.g., 125.50)
4.  Suggested Cost Type: Based on the vendor and items (if visible), suggest one of the following cost types: ${l.join(", ")}.

Receipt Image: {{media url=receiptImageUri}}

Return the extracted information in the specified JSON format. If a field cannot be determined, omit it or set it to null where appropriate based on the schema.
`}),p=a.ai.defineFlow({name:"receiptParserFlow",inputSchema:o,outputSchema:d},async e=>{let{output:t}=await u(e);return t});(0,n.D)([c]),(0,r.A)(c,"40dc12ff6aade17c2b480cff9632b0364b2480bd8f",null);let m=i.z.object({region:i.z.string().min(2,{message:"Region is required."}).describe("The chef's country or region for tax context (e.g., Australia, California, UK)."),query:i.z.string().min(10,{message:"Query must be at least 10 characters."}).describe("The chef's specific tax-related question.")}),h=i.z.object({advice:i.z.string().describe("Generated tax advice based on the region and query."),disclaimer:i.z.string().describe("Standard disclaimer about the advice not being professional financial counsel.")});async function x(e){return g(e)}let f=a.ai.definePrompt({name:"taxAdvicePrompt",input:{schema:m},output:{schema:h},prompt:`You are an AI assistant providing general tax information for chefs.
The chef is in the region: {{{region}}}.
Their question is: "{{{query}}}"

Provide helpful, general tax-related advice relevant to their query and region.

IMPORTANT: Always include the following disclaimer at the end of your advice:
"Disclaimer: This information is for general guidance only and not professional tax or financial advice. Consult with a qualified professional for advice tailored to your specific situation."

Structure your response as a JSON object with "advice" and "disclaimer" fields.
`}),g=a.ai.defineFlow({name:"taxAdviceFlow",inputSchema:m,outputSchema:h},async e=>{let{output:t}=await f(e),s="Disclaimer: This information is for general guidance only and not professional tax or financial advice. Consult with a qualified professional for advice tailored to your specific situation.";return t?.disclaimer?t.disclaimer!==s?{advice:t.advice,disclaimer:`${t.disclaimer} ${s}`.trim()}:t:{advice:t?.advice||"Could not generate advice at this time.",disclaimer:s}});(0,n.D)([x]),(0,r.A)(x,"40927f8807ec76451e0441317d257c24c9ce49bc73",null)},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},35265:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(82614).A)("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]])},37067:e=>{"use strict";e.exports=require("node:http")},37366:e=>{"use strict";e.exports=require("dns")},37830:e=>{"use strict";e.exports=require("node:stream/web")},38229:(e,t,s)=>{Promise.resolve().then(s.bind(s,54461))},44708:e=>{"use strict";e.exports=require("node:https")},46679:(e,t,s)=>{"use strict";s.d(t,{D:()=>a});var r=s(47138);function a(e){let t=(0,r.a)(e);return t.setHours(23,59,59,999),t}},47002:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=47002,e.exports=t},54379:e=>{"use strict";e.exports=require("node:path")},54461:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>en});var r=s(60687),a=s(43210),i=s(63442),n=s(27605),l=s(45880),o=s(29523),d=s(71669),c=s(89667),u=s(34729),p=s(6211),m=s(44493),h=s(15079),x=s(26373),f=s(84401),g=s(91821),j=s(29867),v=s(4780),y=(s(47138),s(47141)),b=s(37074),w=s(46679),N=s(58261),A=s(58682),C=s(11516),I=s(36644),R=s(35265),T=s(82614);let k=(0,T.A)("MessageCircleQuestion",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),q=(0,T.A)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);var P=s(26622),E=s(78726);let M=(0,T.A)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);var S=s(24555),D=s(36558),F=s(91840),$=s(57207),_=s(99196),U=s(20620),G=s(30474),L=s(6475);let O=(0,L.createServerReference)("40dc12ff6aade17c2b480cff9632b0364b2480bd8f",L.callServer,void 0,L.findSourceMapURL,"receiptParserFlow"),z=(0,L.createServerReference)("40927f8807ec76451e0441317d257c24c9ce49bc73",L.callServer,void 0,L.findSourceMapURL,"getTaxAdvice");var B=s(18780),Y=s(33784),V=s(75535),W=s(70146),J=s(30036);let H=(0,J.default)(async()=>{},{loadableGenerated:{modules:["app/chef/dashboard/receipts/page.tsx -> @/components/ui/dialog"]},ssr:!1,loading:()=>(0,r.jsxs)("div",{className:"p-4 text-center",children:[(0,r.jsx)(C.A,{className:"h-6 w-6 animate-spin inline-block"})," Loading Dialog..."]})}),Z=(0,J.default)(async()=>{},{loadableGenerated:{modules:["app/chef/dashboard/receipts/page.tsx -> @/components/ui/dialog"]},ssr:!1}),K=(0,J.default)(async()=>{},{loadableGenerated:{modules:["app/chef/dashboard/receipts/page.tsx -> @/components/ui/dialog"]},ssr:!1}),X=(0,J.default)(async()=>{},{loadableGenerated:{modules:["app/chef/dashboard/receipts/page.tsx -> @/components/ui/dialog"]},ssr:!1}),Q=(0,J.default)(async()=>{},{loadableGenerated:{modules:["app/chef/dashboard/receipts/page.tsx -> @/components/ui/dialog"]},ssr:!1}),ee=(0,J.default)(async()=>{},{loadableGenerated:{modules:["app/chef/dashboard/receipts/page.tsx -> @/components/ui/dialog"]},ssr:!1}),et=(0,J.default)(async()=>{},{loadableGenerated:{modules:["app/chef/dashboard/receipts/page.tsx -> @/components/ui/dialog"]},ssr:!1}),es=(0,J.default)(async()=>{},{loadableGenerated:{modules:["app/chef/dashboard/receipts/page.tsx -> @/components/ui/dialog"]},ssr:!1,loading:()=>(0,r.jsxs)("div",{className:"p-4 text-center",children:[(0,r.jsx)(C.A,{className:"h-6 w-6 animate-spin inline-block"})," Loading Camera..."]})}),er=["Ingredient","Equipment","Tax","BAS","Travel","Other"],ea=l.Ik({vendor:l.Yj().min(1,{message:"Vendor name is required."}),date:l.p6({required_error:"Receipt date is required."}),totalAmount:l.au.number().min(.01,{message:"Total amount must be greater than 0."}),assignedToEventId:l.Yj().optional(),assignedToMenuId:l.Yj().optional(),costType:l.k5(["Ingredient","Equipment","Tax","BAS","Travel","Other"],{required_error:"Cost type is required."}),notes:l.Yj().optional()}),ei=l.Ik({region:l.Yj().min(2,{message:"Region is required (e.g., Australia, California)."}),query:l.Yj().min(10,{message:"Please enter a specific tax question (min 10 characters)."})});function en(){let{user:e}=(0,B.A)(),[t,s]=(0,a.useState)([]),[l,T]=(0,a.useState)(!0),[L,J]=(0,a.useState)(!1),[en,el]=(0,a.useState)(!1),[eo,ed]=(0,a.useState)(null),[ec,eu]=(0,a.useState)(!1),[ep,em]=(0,a.useState)(null),[eh,ex]=(0,a.useState)(null),[ef,eg]=(0,a.useState)(null),[ej,ev]=(0,a.useState)(!1),[ey,eb]=(0,a.useState)(!1),[ew,eN]=(0,a.useState)(!1),[eA,eC]=(0,a.useState)(null),[eI,eR]=(0,a.useState)(!1),eT=(0,a.useRef)(null),ek=(0,a.useRef)(null),eq=(0,a.useRef)(null),[eP,eE]=(0,a.useState)("all"),[eM,eS]=(0,a.useState)(void 0),[eD,eF]=(0,a.useState)(void 0),{toast:e$}=(0,j.dj)(),e_=(0,n.mN)({resolver:(0,i.u)(ea),defaultValues:{vendor:"",date:new Date,totalAmount:0,assignedToEventId:"",assignedToMenuId:"",costType:void 0,notes:""}}),eU=(0,n.mN)({resolver:(0,i.u)(ei),defaultValues:{region:"",query:""}}),eG=(0,a.useMemo)(()=>t.filter(e=>{let t="all"===eP||e.costType===eP,s=e.date;if(s instanceof Date||!s||(s=new Date(s)),!(0,y.f)(s))return!1;let r=(0,b.o)(s),a=!eM||r>=(0,b.o)(eM),i=!eD||r<=(0,w.D)(eD);return t&&a&&i}),[t,eP,eM,eD]),eL=(e=null)=>{if(ed(e),ex(e?.imageUrl||null),eg(e?.fileName||null),ev(!1),eq.current&&(eq.current.value=""),e){let t=new Date;e.date&&(e.date instanceof V.Dc?t=e.date.toDate():e.date instanceof Date&&(0,y.f)(receiptToSet)&&(t=e.date)),e_.reset({vendor:e.vendor,date:t,totalAmount:e.totalAmount,assignedToEventId:e.assignedToEventId||"",assignedToMenuId:e.assignedToMenuId||"",costType:e.costType,notes:e.notes||""})}else e_.reset({vendor:"",date:new Date,totalAmount:0,assignedToEventId:"",assignedToMenuId:"",costType:void 0,notes:""});el(!0)},eO=async()=>{if(!eh)return void e$({title:"No Image",description:"Please capture or upload an image first.",variant:"destructive"});eb(!0),e$({title:"AI Processing",description:"Analyzing receipt image..."});try{let e=await O({receiptImageUri:eh});if(e){if(e.vendor&&e_.setValue("vendor",e.vendor),e.date)try{let t=(0,N.H)(e.date);(0,y.f)(t)||(t=new Date(e.date.replace(/-/g,"/"))),(0,y.f)(t)?e_.setValue("date",t):(console.warn("AI returned unparsable date format for receipt:",e.date),e$({title:"AI Autofill",description:"Could not parse date from AI. Please set manually.",variant:"default"}))}catch(t){console.warn("Error processing date from AI for receipt:",e.date,t),e$({title:"AI Autofill",description:"Error processing date from AI. Please set manually.",variant:"default"})}void 0!==e.totalAmount&&null!==e.totalAmount&&e_.setValue("totalAmount",e.totalAmount),e.suggestedCostType&&e_.setValue("costType",e.suggestedCostType),e$({title:"AI Autofill Complete",description:"Fields populated. Please review."})}else e$({title:"AI Autofill",description:"Could not extract all information. Please fill manually.",variant:"default"})}catch(t){console.error("Error parsing receipt with AI:",t);let e=`Failed to process receipt with AI. ${t.message}`;t.message&&t.message.toLowerCase().includes("api key not valid")&&(e="AI Service Error: Invalid API Key for receipt parsing."),e$({title:"AI Error",description:e,variant:"destructive"})}finally{eb(!1)}},ez=e=>{try{let t=atob(e.split(",")[1]),s=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(t.length),a=new Uint8Array(r);for(let e=0;e<t.length;e++)a[e]=t.charCodeAt(e);return new Blob([r],{type:s})}catch(e){return console.error("Error converting data URI to Blob:",e),e$({title:"Image Error",description:"Could not process captured image.",variant:"destructive"}),null}},eB=async t=>{if(!e)return void e$({title:"Error",description:"You must be logged in.",variant:"destructive"});if(!eh&&!eo?.imageUrl)return void e$({title:"Image Required",description:"Please capture or upload a receipt image.",variant:"destructive"});J(!0);let s=eo?.imageUrl||"",r=ef||eo?.fileName||`receipt_${Date.now()}.jpg`;try{let a=eo?.id||(0,V.H9)((0,V.rJ)(Y.db,`users/${e.uid}/receipts`)).id,i=(0,V.H9)(Y.db,"users",e.uid,"receipts",a);if(eh&&(!eo||eh!==eo.imageUrl)){if(eo?.imageUrl&&eo.imageUrl.startsWith("https://firebasestorage.googleapis.com"))try{let e=(0,W.KR)(Y.IG,eo.imageUrl);await (0,W.XR)(e)}catch(e){"storage/object-not-found"!==e.code&&console.warn("ReceiptsPage: Could not delete old receipt image during update:",e.message)}let t=ez(eh);if(!t)throw Error("Failed to convert image data for upload.");let i=`users/${e.uid}/receipts/${a}/${r.replace(/[^a-zA-Z0-9_.-]/g,"_")}`,n=(0,W.KR)(Y.IG,i),l=(0,W.bp)(n,t);await new Promise((e,t)=>{l.on("state_changed",e=>{},e=>{console.error("Receipt image upload error:",e),t(e)},async()=>{try{s=await (0,W.qk)(l.snapshot.ref),e()}catch(e){console.error("Error getting download URL for receipt image:",e),t(e)}})})}let n={...t,chefId:e.uid,date:V.Dc.fromDate(t.date),imageUrl:s,fileName:r,updatedAt:(0,V.O5)()};eo?(await (0,V.mZ)(i,n),e$({title:"Receipt Updated",description:`Receipt from "${t.vendor}" has been updated.`})):(await (0,V.BN)(i,{...n,id:i.id,createdAt:(0,V.O5)()}),e$({title:"Receipt Added",description:`Receipt from "${t.vendor}" has been added.`})),e_.reset(),ed(null),el(!1),ex(null),eg(null),eq.current&&(eq.current.value="")}catch(e){console.error("Error saving receipt:",e),e$({title:"Save Failed",description:`Could not save receipt. ${e.message}`,variant:"destructive"})}finally{J(!1)}},eY=async s=>{if(!e)return void e$({title:"Authentication Error",description:"You must be logged in.",variant:"destructive"});let r=t.find(e=>e.id===s);if(!r)return void e$({title:"Error",description:"Receipt not found.",variant:"destructive"});if(window.confirm(`Are you sure you want to delete the receipt from "${r?.vendor}"?`)){J(!0);try{if(r.imageUrl&&r.imageUrl.startsWith("https://firebasestorage.googleapis.com"))try{let e=(0,W.KR)(Y.IG,r.imageUrl);await (0,W.XR)(e)}catch(e){"storage/object-not-found"!==e.code&&console.warn("ReceiptsPage: Could not delete receipt image from storage during receipt deletion:",e.message)}await (0,V.kd)((0,V.H9)(Y.db,"users",e.uid,"receipts",s)),e$({title:"Receipt Deleted",description:`Receipt from "${r?.vendor}" removed.`,variant:"destructive"})}catch(e){console.error("Error deleting receipt:",e),e$({title:"Delete Error",description:`Could not delete receipt. ${e.message}`,variant:"destructive"})}finally{J(!1)}}},eV=(0,a.useMemo)(()=>eG.reduce((e,t)=>e+t.totalAmount,0),[eG]),eW=(0,a.useMemo)(()=>{let e={};return er.forEach(t=>e[t]=0),eG.forEach(t=>{er.includes(t.costType)&&(e[t.costType]=(e[t.costType]||0)+t.totalAmount)}),e},[eG]),eJ=async e=>{eR(!0),eC(null),e$({title:"Getting Tax Advice",description:"Please wait..."});try{let t=await z(e);eC(t)}catch(t){console.error("Error getting tax advice:",t);let e=`Failed to get tax advice. ${t.message}`;t.message&&t.message.toLowerCase().includes("api key not valid")&&(e="AI Service Error: Invalid API Key for tax advice."),e$({title:"AI Error",description:e,variant:"destructive"}),eC({advice:"Could not retrieve advice at this time.",disclaimer:"Please try again later."})}finally{eR(!1)}};return l&&(!e||0===t.length)?(0,r.jsxs)("div",{className:"flex justify-center items-center h-64",children:[(0,r.jsx)(C.A,{className:"h-8 w-8 animate-spin text-primary","data-ai-hint":"loading spinner"}),(0,r.jsx)("p",{className:"ml-2",children:"Loading receipts data..."})]}):(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,r.jsxs)("h1",{className:"text-3xl font-bold flex items-center",children:[(0,r.jsx)(I.A,{className:"mr-3 h-8 w-8 text-primary","data-ai-hint":"document file"})," Receipts & Cost Management"]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsxs)(o.$,{onClick:()=>eL(),disabled:L||ey,children:[(0,r.jsx)(R.A,{className:"mr-2 h-5 w-5"})," Add New Receipt"]}),H&&(0,r.jsxs)(o.$,{variant:"outline",onClick:()=>{eU.reset(),eC(null),eN(!0)},children:[(0,r.jsx)(k,{className:"mr-2 h-5 w-5"})," Get Tax Advice"]})]})]}),(0,r.jsxs)(m.Zp,{children:[(0,r.jsx)(m.aR,{children:(0,r.jsxs)(m.ZB,{className:"flex items-center",children:[(0,r.jsx)(q,{className:"mr-2 h-5 w-5 text-primary","data-ai-hint":"filter icon"})," Filter Receipts"]})}),(0,r.jsxs)(m.Wu,{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end",children:[(0,r.jsxs)(d.eI,{children:[(0,r.jsx)(d.lR,{children:"Cost Type"}),(0,r.jsxs)(h.l6,{value:eP,onValueChange:eE,children:[(0,r.jsx)(h.bq,{children:(0,r.jsx)(h.yv,{placeholder:"All Cost Types"})}),(0,r.jsxs)(h.gC,{children:[(0,r.jsx)(h.eb,{value:"all",children:"All Cost Types"}),er.map(e=>(0,r.jsx)(h.eb,{value:e,children:e},e))]})]})]}),(0,r.jsxs)(d.eI,{children:[(0,r.jsx)(d.lR,{children:"Start Date"}),(0,r.jsxs)(f.AM,{children:[(0,r.jsx)(f.Wv,{asChild:!0,children:(0,r.jsxs)(o.$,{variant:"outline",className:(0,v.cn)("w-full justify-start text-left font-normal",!eM&&"text-muted-foreground"),children:[(0,r.jsx)(P.A,{className:"mr-2 h-4 w-4"}),eM?(0,A.GP)(eM,"PPP"):(0,r.jsx)("span",{children:"Pick a start date"})]})}),(0,r.jsx)(f.hl,{className:"w-auto p-0",children:(0,r.jsx)(x.V,{mode:"single",selected:eM,onSelect:eS,initialFocus:!0})})]})]}),(0,r.jsxs)(d.eI,{children:[(0,r.jsx)(d.lR,{children:"End Date"}),(0,r.jsxs)(f.AM,{children:[(0,r.jsx)(f.Wv,{asChild:!0,children:(0,r.jsxs)(o.$,{variant:"outline",className:(0,v.cn)("w-full justify-start text-left font-normal",!eD&&"text-muted-foreground"),children:[(0,r.jsx)(P.A,{className:"mr-2 h-4 w-4"}),eD?(0,A.GP)(eD,"PPP"):(0,r.jsx)("span",{children:"Pick an end date"})]})}),(0,r.jsx)(f.hl,{className:"w-auto p-0",children:(0,r.jsx)(x.V,{mode:"single",selected:eD,onSelect:eF,initialFocus:!0,disabled:e=>!!eM&&e<eM})})]})]}),(0,r.jsxs)(o.$,{onClick:()=>{eE("all"),eS(void 0),eF(void 0)},variant:"outline",className:"self-end",children:[(0,r.jsx)(E.A,{className:"mr-2 h-4 w-4"})," Clear Filters"]})]})]}),en&&H&&Z&&K&&X&&Q&&ee&&(0,r.jsx)(H,{open:en,onOpenChange:e=>{(L||ey)&&e||(el(e),!e&&(ex(null),eg(null),ev(!1),eq.current&&(eq.current.value="")))},children:(0,r.jsxs)(Z,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)(K,{children:[(0,r.jsx)(X,{children:eo?"Edit Receipt":"Add New Receipt"}),et&&(0,r.jsx)(et,{children:"Fill in the details for your expense. Use camera or upload a file."})]}),(0,r.jsx)(d.lV,{...e_,children:(0,r.jsxs)("form",{onSubmit:e_.handleSubmit(eB),className:"space-y-4 p-1",children:[(0,r.jsxs)(d.eI,{children:[(0,r.jsx)(d.lR,{children:"Receipt Image"}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row items-center gap-2",children:[es&&(0,r.jsxs)(o.$,{type:"button",variant:"outline",onClick:()=>{em(null),ev(!1),eu(!0)},className:"w-full sm:w-auto",children:[(0,r.jsx)(M,{className:"mr-2 h-4 w-4"})," Capture with Camera"]}),(0,r.jsx)("span",{className:"text-xs text-muted-foreground hidden sm:block",children:"OR"}),(0,r.jsx)(c.p,{id:"receipt-upload-input",type:"file",accept:"image/png, image/jpeg, image/webp, application/pdf",className:"w-full sm:flex-1",onChange:e=>{let t=e.target.files?.[0];if(t){eg(t.name);let e=new FileReader;e.onloadend=()=>{ex(e.result)},e.readAsDataURL(t)}else eg(null),ex(null)},ref:eq})]}),eh&&(0,r.jsxs)("div",{className:"mt-2 text-center",children:[(0,r.jsx)(G.default,{src:eh,alt:"Receipt preview",width:150,height:200,className:"rounded-md object-contain mx-auto border","data-ai-hint":"receipt document"}),ef&&(0,r.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Preview of: ",ef]})]}),(0,r.jsx)(d.Rr,{children:"Max 5MB. PDF, JPG, PNG, WEBP."}),(0,r.jsxs)(o.$,{type:"button",onClick:eO,disabled:!eh||ey||L,variant:"outline",className:"w-full mt-2",children:[ey?(0,r.jsx)(C.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(S.A,{className:"mr-2 h-4 w-4"}),ey?"Parsing...":"Auto-fill with AI (from image)"]})]}),(0,r.jsx)(d.zB,{control:e_.control,name:"vendor",render:({field:e})=>(0,r.jsxs)(d.eI,{children:[(0,r.jsx)(d.lR,{children:"Vendor Name"}),(0,r.jsx)(d.MJ,{children:(0,r.jsx)(c.p,{placeholder:"e.g., Fresh Produce Market",...e})}),(0,r.jsx)(d.C5,{})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsx)(d.zB,{control:e_.control,name:"date",render:({field:e})=>(0,r.jsxs)(d.eI,{className:"flex flex-col",children:[(0,r.jsx)(d.lR,{children:"Date of Receipt"}),(0,r.jsxs)(f.AM,{children:[(0,r.jsx)(f.Wv,{asChild:!0,children:(0,r.jsx)(d.MJ,{children:(0,r.jsxs)(o.$,{variant:"outline",className:(0,v.cn)("w-full pl-3 text-left font-normal",!e.value&&"text-muted-foreground"),children:[e.value?(0,A.GP)(e.value,"PPP"):(0,r.jsx)("span",{children:"Pick a date"}),(0,r.jsx)(P.A,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),(0,r.jsx)(f.hl,{className:"w-auto p-0",align:"start",children:(0,r.jsx)(x.V,{mode:"single",selected:e.value,onSelect:e.onChange,initialFocus:!0})})]}),(0,r.jsx)(d.C5,{})]})}),(0,r.jsx)(d.zB,{control:e_.control,name:"totalAmount",render:({field:e})=>(0,r.jsxs)(d.eI,{children:[(0,r.jsx)(d.lR,{children:"Total Amount ($)"}),(0,r.jsx)(d.MJ,{children:(0,r.jsx)(c.p,{type:"number",step:"0.01",placeholder:"e.g., 45.99",...e})}),(0,r.jsx)(d.C5,{})]})})]}),(0,r.jsx)(d.zB,{control:e_.control,name:"costType",render:({field:e})=>(0,r.jsxs)(d.eI,{children:[(0,r.jsx)(d.lR,{children:"Cost Type"}),(0,r.jsxs)(h.l6,{onValueChange:e.onChange,value:e.value,defaultValue:e.value,children:[(0,r.jsx)(d.MJ,{children:(0,r.jsx)(h.bq,{children:(0,r.jsx)(h.yv,{placeholder:"Select a cost type"})})}),(0,r.jsx)(h.gC,{children:er.map(e=>(0,r.jsx)(h.eb,{value:e,children:e},e))})]}),(0,r.jsx)(d.C5,{})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsx)(d.zB,{control:e_.control,name:"assignedToEventId",render:({field:e})=>(0,r.jsxs)(d.eI,{children:[(0,r.jsx)(d.lR,{children:"Assign to Event ID (Optional)"}),(0,r.jsx)(d.MJ,{children:(0,r.jsx)(c.p,{placeholder:"e.g., event123",...e})}),(0,r.jsx)(d.Rr,{children:"Link this expense to a specific event."}),(0,r.jsx)(d.C5,{})]})}),(0,r.jsx)(d.zB,{control:e_.control,name:"assignedToMenuId",render:({field:e})=>(0,r.jsxs)(d.eI,{children:[(0,r.jsx)(d.lR,{children:"Assign to Menu ID (Optional)"}),(0,r.jsx)(d.MJ,{children:(0,r.jsx)(c.p,{placeholder:"e.g., menu456",...e})}),(0,r.jsx)(d.Rr,{children:"Link this expense to a specific menu."}),(0,r.jsx)(d.C5,{})]})})]}),(0,r.jsx)(d.zB,{control:e_.control,name:"notes",render:({field:e})=>(0,r.jsxs)(d.eI,{children:[(0,r.jsx)(d.lR,{children:"Notes (Optional)"}),(0,r.jsx)(d.MJ,{children:(0,r.jsx)(u.T,{placeholder:"e.g., Specific items, reason for expense",...e})}),(0,r.jsx)(d.C5,{})]})}),(0,r.jsxs)(Q,{children:[(0,r.jsx)(ee,{asChild:!0,children:(0,r.jsx)(o.$,{type:"button",variant:"outline",disabled:L||ey,children:"Cancel"})}),(0,r.jsx)(o.$,{type:"submit",disabled:L||ey,children:L?(0,r.jsx)(C.A,{className:"mr-2 h-4 w-4 animate-spin"}):eo?"Save Changes":"Add Receipt"})]})]})})]})}),ec&&es&&Z&&K&&X&&Q&&ee&&(0,r.jsx)(es,{open:ec,onOpenChange:e=>{!e&&eT.current?.srcObject&&(eT.current.srcObject.getTracks().forEach(e=>e.stop()),eT.current.srcObject=null,em(null)),eu(e),e||ev(!1)},children:(0,r.jsxs)(Z,{className:"sm:max-w-md",children:[(0,r.jsx)(K,{children:(0,r.jsx)(X,{children:"Capture Receipt with Camera"})}),!1===ep&&(0,r.jsxs)(g.Fc,{variant:"destructive",children:[(0,r.jsx)(g.XL,{children:"Camera Access Required"}),(0,r.jsx)(g.TN,{children:"Please allow camera access in your browser settings to use this feature. You might need to refresh the page after granting permission."})]}),(0,r.jsx)("video",{ref:eT,className:(0,v.cn)("w-full aspect-video rounded-md bg-muted",{hidden:ej}),autoPlay:!0,playsInline:!0,muted:!0,"data-ai-hint":"camera feed"}),(0,r.jsx)("canvas",{ref:ek,className:"hidden"}),ej&&eh&&(0,r.jsx)(G.default,{src:eh,alt:"Captured receipt",width:400,height:300,className:"rounded-md object-contain mx-auto border","data-ai-hint":"receipt scan"}),(0,r.jsx)(Q,{className:"sm:justify-between mt-2",children:ej?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.$,{type:"button",variant:"outline",onClick:()=>{ev(!1),ex(null),eg(null),em(null)},children:"Retake"}),(0,r.jsx)(o.$,{type:"button",onClick:()=>{eu(!1),ev(!1)},children:"Use This Image"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ee,{asChild:!0,children:(0,r.jsx)(o.$,{type:"button",variant:"outline",children:"Cancel"})}),(0,r.jsx)(o.$,{type:"button",onClick:()=>{if(eT.current&&ek.current){let e=eT.current,t=ek.current;t.width=e.videoWidth,t.height=e.videoHeight;let s=t.getContext("2d");s&&(s.drawImage(e,0,0,t.width,t.height),ex(t.toDataURL("image/jpeg")),eg(`cam_capture_${Date.now()}.jpg`),ev(!0),eT.current?.srcObject&&(eT.current.srcObject.getTracks().forEach(e=>e.stop()),eT.current.srcObject=null),em(null))}},disabled:!0!==ep,children:"Capture Photo"})]})})]})}),ew&&H&&Z&&K&&X&&Q&&ee&&(0,r.jsx)(H,{open:ew,onOpenChange:eN,children:(0,r.jsxs)(Z,{className:"sm:max-w-lg",children:[(0,r.jsxs)(K,{children:[(0,r.jsx)(X,{children:"AI Tax Advice Assistant"}),et&&(0,r.jsx)(et,{children:"Ask a tax-related question based on your region. This is not professional advice."})]}),(0,r.jsx)(d.lV,{...eU,children:(0,r.jsxs)("form",{onSubmit:eU.handleSubmit(eJ),className:"space-y-4",children:[(0,r.jsx)(d.zB,{control:eU.control,name:"region",render:({field:e})=>(0,r.jsxs)(d.eI,{children:[(0,r.jsx)(d.lR,{children:"Your Country/Region"}),(0,r.jsx)(d.MJ,{children:(0,r.jsx)(c.p,{placeholder:"e.g., Australia, California, UK",...e})}),(0,r.jsx)(d.C5,{})]})}),(0,r.jsx)(d.zB,{control:eU.control,name:"query",render:({field:e})=>(0,r.jsxs)(d.eI,{children:[(0,r.jsx)(d.lR,{children:"Your Tax Question"}),(0,r.jsx)(d.MJ,{children:(0,r.jsx)(u.T,{placeholder:"e.g., What are common tax deductions for private chefs?",...e})}),(0,r.jsx)(d.C5,{})]})}),(0,r.jsxs)(o.$,{type:"submit",disabled:eI,className:"w-full",children:[eI?(0,r.jsx)(C.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(k,{className:"mr-2 h-4 w-4"}),eI?"Getting Advice...":"Ask AI"]})]})}),eA&&(0,r.jsxs)("div",{className:"mt-6 space-y-3 rounded-md border bg-muted/50 p-4",children:[(0,r.jsx)("h4",{className:"font-semibold",children:"AI Response:"}),(0,r.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:eA.advice}),(0,r.jsx)("p",{className:"text-xs italic text-muted-foreground",children:eA.disclaimer})]}),(0,r.jsx)(Q,{className:"mt-4",children:(0,r.jsx)(ee,{asChild:!0,children:(0,r.jsx)(o.$,{type:"button",variant:"outline",children:"Close"})})})]})}),(0,r.jsxs)(m.Zp,{children:[(0,r.jsx)(m.aR,{children:(0,r.jsx)(m.ZB,{children:"Expenses Summary"})}),(0,r.jsx)(m.Wu,{children:l&&0===eG.length?(0,r.jsxs)("div",{className:"flex justify-center items-center py-8",children:[(0,r.jsx)(C.A,{className:"h-6 w-6 animate-spin text-primary","data-ai-hint":"loading icon"}),(0,r.jsx)("p",{className:"ml-2",children:"Loading summary..."})]}):0===eG.length&&t.length>0?(0,r.jsx)("p",{className:"text-muted-foreground text-center py-4",children:"No receipts match the current filters."}):(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-semibold mb-2",children:"By Cost Type (Filtered):"}),Object.entries(eW).map(([e,t])=>(t??0)>0&&(0,r.jsxs)("div",{className:"flex justify-between text-sm py-1 border-b last:border-b-0",children:[(0,r.jsxs)("span",{children:[e,":"]}),(0,r.jsxs)("span",{className:"font-medium",children:["$",(t??0).toFixed(2)]})]},e)),Object.values(eW).every(e=>(e??0)===0)&&eG.length>0&&(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"No expenses for selected filters in these cost types."}),0===eG.length&&(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"No expenses to summarize."})]}),(0,r.jsxs)("div",{className:"flex flex-col justify-end items-end pt-4 md:pt-0",children:[(0,r.jsxs)("div",{className:"text-lg font-semibold flex items-center",children:[(0,r.jsx)(D.A,{className:"mr-1 h-5 w-5 text-green-600","data-ai-hint":"money cost"}),"Total (Filtered): $",eV.toFixed(2)]}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Total of ",eG.length," receipt(s) matching filters."]})]})]})})]}),(0,r.jsxs)(m.Zp,{children:[(0,r.jsx)(m.aR,{children:(0,r.jsx)(m.ZB,{children:"Uploaded Receipts"})}),(0,r.jsx)(m.Wu,{children:l&&0===t.length?(0,r.jsxs)("div",{className:"flex justify-center items-center py-8",children:[(0,r.jsx)(C.A,{className:"h-6 w-6 animate-spin text-primary","data-ai-hint":"loading data"}),(0,r.jsx)("p",{className:"ml-2",children:"Loading receipts..."})]}):eG.length>0?(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.XI,{children:[(0,r.jsx)(p.A0,{children:(0,r.jsxs)(p.Hj,{children:[(0,r.jsx)(p.nd,{children:"Vendor"}),(0,r.jsx)(p.nd,{children:"Date"}),(0,r.jsx)(p.nd,{className:"text-right",children:"Amount"}),(0,r.jsx)(p.nd,{children:"Cost Type"}),(0,r.jsx)(p.nd,{children:"Assigned To"}),(0,r.jsx)(p.nd,{children:"File/Notes"}),(0,r.jsx)(p.nd,{className:"text-right w-[120px]",children:"Actions"})]})}),(0,r.jsx)(p.BF,{children:eG.map(e=>(0,r.jsxs)(p.Hj,{children:[(0,r.jsx)(p.nA,{className:"font-medium",children:e.vendor}),(0,r.jsx)(p.nA,{children:e.date&&(0,y.f)(new Date(e.date))?(0,A.GP)(new Date(e.date),"PP"):"N/A"}),(0,r.jsxs)(p.nA,{className:"text-right",children:["$",e.totalAmount.toFixed(2)]}),(0,r.jsx)(p.nA,{children:e.costType}),(0,r.jsxs)(p.nA,{className:"text-xs",children:[e.assignedToEventId&&(0,r.jsxs)("div",{children:["Event: ",e.assignedToEventId.substring(0,8),"..."]}),e.assignedToMenuId&&(0,r.jsxs)("div",{children:["Menu: ",e.assignedToMenuId.substring(0,8),"..."]})]}),(0,r.jsxs)(p.nA,{className:"text-xs text-muted-foreground truncate max-w-[150px] sm:max-w-[200px]",children:[e.fileName&&(0,r.jsx)("div",{className:"font-medium text-foreground",children:e.fileName.length>20?e.fileName.substring(0,17)+"...":e.fileName}),e.imageUrl&&(0,r.jsx)("a",{href:e.imageUrl,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-500 hover:underline",children:"(View Image)"}),e.notes&&(0,r.jsx)("div",{className:"italic",children:e.notes.length>30?e.notes.substring(0,27)+"...":e.notes})]}),(0,r.jsx)(p.nA,{className:"text-right",children:(0,r.jsxs)("div",{className:"flex justify-end space-x-1",children:[(0,r.jsxs)(o.$,{variant:"ghost",size:"icon",onClick:()=>eL(e),className:"mr-1",disabled:L||ey,children:[(0,r.jsx)(F.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Edit"})]}),(0,r.jsxs)(o.$,{variant:"ghost",size:"icon",onClick:()=>eY(e.id),className:"text-destructive hover:text-destructive",disabled:L||ey,children:[(0,r.jsx)($.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Delete"})]})]})})]},e.id))})]})}):(0,r.jsx)("p",{className:"text-muted-foreground text-center py-8",children:0===t.length?"No receipts uploaded yet. Start by adding your first expense!":"No receipts match the current filters. Try adjusting or clearing them."})})]}),(0,r.jsxs)(m.Zp,{className:"mt-8",children:[(0,r.jsx)(m.aR,{children:(0,r.jsx)(m.ZB,{children:"Financial Tools & Future Features"})}),(0,r.jsxs)(m.Wu,{className:"space-y-3 text-sm text-muted-foreground",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Event Profitability:"})," In the future, you'll be able to filter receipts by Event ID to see specific cost breakdowns and calculate profitability for each event."]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Invoice Generation:"})," Upon event completion and confirmation, invoices will be automatically generated for both you and the customer, accessible through your respective dashboards."]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"AI Cost Insights:"})," We're working on AI tools to provide deeper insights into your spending patterns, helping you optimize menu pricing and purchasing."]})]})]}),(0,r.jsxs)(g.Fc,{className:"mt-8",children:[(0,r.jsx)(_.A,{className:"h-4 w-4","data-ai-hint":"info icon"}),(0,r.jsx)(g.XL,{children:"Payout & Financial Information"}),(0,r.jsx)(g.TN,{children:(0,r.jsxs)("ul",{className:"list-disc list-inside text-xs space-y-1",children:[(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Initial Fund Distribution:"})," Upon customer booking confirmation and payment, 46% of the event cost is released to the chef and 4% to FindAChef immediately (requires backend Stripe Connect integration)."]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Escrow & Final Release:"})," The remaining 50% is held. This portion is released to the chef after the event is confirmed complete by the customer (e.g., via QR code scan at the event, requires backend)."]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Public Ticketed Events:"})," For events you host and sell tickets for via The Chef's Wall, payouts are generally scheduled 7 days *before* the event date to assist with upfront costs (subject to terms, requires backend logic)."]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Cancellations by Chef:"})," If a chef cancels an event, a full refund is issued to the customer. Admin will be notified to assist and manage chef accountability, which may include penalties if a replacement cannot be found."]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Cancellations by Customer:"}),(0,r.jsxs)("ul",{className:"list-['-_'] list-inside ml-4",children:[(0,r.jsx)("li",{children:"If a customer cancels more than 20 days before the event, a 50% refund is typically processed."}),(0,r.jsx)("li",{children:"If a customer cancels less than 20 days before the event, a 20% refund is processed. In this case, 15% of the total event cost may go to the chef and 15% to FindAChef (subject to terms)."}),(0,r.jsxs)("li",{children:["Refer to the full ",(0,r.jsx)(Link,{href:"/terms#cancellation",className:"underline hover:text-primary",children:"Terms of Service"})," for complete cancellation policy details."]})]})]}),(0,r.jsx)("li",{children:"Always ensure all receipts for an event are uploaded promptly for accurate cost tracking and potential tax purposes."})]})})]}),(0,r.jsx)("div",{className:"flex justify-end mt-6",children:(0,r.jsxs)(o.$,{onClick:()=>{if(0===eG.length)return void e$({title:"No Data",description:"Receipt list (with current filters) is empty.",variant:"default"});let e=new Blob([["Vendor,Date,Total Amount,Cost Type,Assigned to Event ID,Assigned to Menu ID,Notes,File Name,Image URL",...eG.map(e=>{let t="";if(e.date){let s=e.date instanceof V.Dc?e.date.toDate():new Date(e.date);(0,y.f)(s)&&(t=(0,A.GP)(s,"yyyy-MM-dd"))}return[`"${(e.vendor||"").replace(/"/g,'""')}"`,t,e.totalAmount.toFixed(2),`"${(e.costType||"").replace(/"/g,'""')}"`,`"${(e.assignedToEventId||"").replace(/"/g,'""')}"`,`"${(e.assignedToMenuId||"").replace(/"/g,'""')}"`,`"${(e.notes||"").replace(/"/g,'""')}"`,`"${(e.fileName||"").replace(/"/g,'""')}"`,`"${(e.imageUrl||"").replace(/"/g,'""')}"`].join(",")})].join("\n")],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a");if(void 0!==t.download){let s=URL.createObjectURL(e);t.setAttribute("href",s),t.setAttribute("download","filtered_receipts_export.csv"),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(s)}e$({title:"Export Successful",description:"Filtered receipts exported to CSV."})},variant:"outline",disabled:0===eG.length||l,children:[(0,r.jsx)(U.A,{className:"mr-2 h-5 w-5"})," Export Filtered Data (CSV)"]})})]})}},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},56801:e=>{"use strict";e.exports=require("import-in-the-middle")},57075:e=>{"use strict";e.exports=require("node:stream")},57207:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(82614).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},57975:e=>{"use strict";e.exports=require("node:util")},60806:(e,t,s)=>{Promise.resolve().then(s.bind(s,16963))},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73024:e=>{"use strict";e.exports=require("node:fs")},73136:e=>{"use strict";e.exports=require("node:url")},73496:e=>{"use strict";e.exports=require("http2")},73566:e=>{"use strict";e.exports=require("worker_threads")},74075:e=>{"use strict";e.exports=require("zlib")},74998:e=>{"use strict";e.exports=require("perf_hooks")},77030:e=>{"use strict";e.exports=require("node:net")},77598:e=>{"use strict";e.exports=require("node:crypto")},78958:(e,t,s)=>{Promise.resolve().then(s.bind(s,30769))},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},79646:e=>{"use strict";e.exports=require("child_process")},79748:e=>{"use strict";e.exports=require("fs/promises")},81630:e=>{"use strict";e.exports=require("http")},84297:e=>{"use strict";e.exports=require("async_hooks")},91645:e=>{"use strict";e.exports=require("net")},91821:(e,t,s)=>{"use strict";s.d(t,{Fc:()=>o,TN:()=>c,XL:()=>d});var r=s(60687),a=s(43210),i=s(24224),n=s(4780);let l=(0,i.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),o=a.forwardRef(({className:e,variant:t,...s},a)=>(0,r.jsx)("div",{ref:a,role:"alert",className:(0,n.cn)(l({variant:t}),e),...s}));o.displayName="Alert";let d=a.forwardRef(({className:e,...t},s)=>(0,r.jsx)("h5",{ref:s,className:(0,n.cn)("mb-1 font-medium leading-none tracking-tight",e),...t}));d.displayName="AlertTitle";let c=a.forwardRef(({className:e,...t},s)=>(0,r.jsx)("div",{ref:s,className:(0,n.cn)("text-sm [&_p]:leading-relaxed",e),...t}));c.displayName="AlertDescription"},91840:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(82614).A)("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]])},93993:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/user/studio/src/app/chef/dashboard/receipts/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/user/studio/src/app/chef/dashboard/receipts/page.tsx","default")},94735:e=>{"use strict";e.exports=require("events")},95427:(e,t,s)=>{"use strict";s.d(t,{ai:()=>i});var r=s(37612),a=s(56758);process.env.GOOGLE_API_KEY?console.log("Genkit: GOOGLE_API_KEY found (first 5 chars):",process.env.GOOGLE_API_KEY.substring(0,5)+"..."):console.warn("Genkit: GOOGLE_API_KEY is NOT defined in environment variables. AI features requiring this key (especially server-side flows or Genkit dev server) will fail.");let i=(0,r.genkit)({plugins:[(0,a.YF)({})],model:"googleai/gemini-pro",model:"googleai/gemini-1.5-flash-latest"})},96373:(e,t,s)=>{Promise.resolve().then(s.bind(s,93993))}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[4447,6706,1658,474,3033,417,399,2105,8682,5509,9345,3084,8598,9111,2628,1063],()=>s(954));module.exports=r})();